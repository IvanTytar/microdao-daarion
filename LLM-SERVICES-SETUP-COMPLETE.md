# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è LLM –°–µ—Ä–≤—ñ—Å—ñ–≤ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ

**–î–∞—Ç–∞:** 2025-11-23  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ —Ç–∞ –ø—Ä–∞—Ü—é—î

---

## üîß –í–∏–∫–æ–Ω–∞–Ω—ñ –∑–º—ñ–Ω–∏

### 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Ollama –¥–ª—è –¥–æ—Å—Ç—É–ø—É –∑ Docker

**–ü—Ä–æ–±–ª–µ–º–∞:** Ollama —Å–ª—É—Ö–∞–≤ —Ç—ñ–ª—å–∫–∏ –Ω–∞ `127.0.0.1:11434`, —Ç–æ–º—É Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –Ω–µ –º–æ–≥–ª–∏ –¥–æ—Å—Ç—É–∫–∞—Ç–∏—Å—è.

**–†—ñ—à–µ–Ω–Ω—è:** –ù–∞–ª–∞—à—Ç—É–≤–∞–ª–∏ Ollama —Å–ª—É—Ö–∞—Ç–∏ –Ω–∞ –≤—Å—ñ—Ö —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (`0.0.0.0:11434`).

**–§–∞–π–ª:** `/etc/systemd/system/ollama.service.d/override.conf`

```ini
[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
Environment="OLLAMA_NUM_GPU=1"
Environment="OLLAMA_GPU_LAYERS=35"
Environment="CUDA_VISIBLE_DEVICES=0"
Environment="OLLAMA_KEEP_ALIVE=24h"
```

**–ö–æ–º–∞–Ω–¥–∏:**
```bash
# –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
echo '[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
Environment="OLLAMA_NUM_GPU=1"
Environment="OLLAMA_GPU_LAYERS=35"
Environment="CUDA_VISIBLE_DEVICES=0"
Environment="OLLAMA_KEEP_ALIVE=24h"' > /etc/systemd/system/ollama.service.d/override.conf

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Ollama
systemctl daemon-reload
systemctl restart ollama
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ Ollama —Ç–µ–ø–µ—Ä —Å–ª—É—Ö–∞—î –Ω–∞ `*:11434` (–≤—Å—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏)
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –º–æ–∂—É—Ç—å –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ `172.17.0.1:11434`
- ‚úÖ Router –º–æ–∂–µ –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –¥–æ Ollama

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

### 1. –°—Ç–∞—Ç—É—Å Ollama
```bash
$ systemctl status ollama
‚óè ollama.service - Ollama Service
     Active: active (running)
     OLLAMA_HOST: http://0.0.0.0:11434
```

### 2. –î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –∑ Docker
```bash
$ docker exec dagi-router curl -s http://172.17.0.1:11434/api/tags
{"models":[...]} # ‚úÖ –ü—Ä–∞—Ü—é—î
```

### 3. –¢–µ—Å—Ç Router –∑ –∞–≥–µ–Ω—Ç–æ–º Helion
```bash
$ curl -X POST http://144.76.224.179:9102/route \
  -H 'Content-Type: application/json' \
  -d '{"agent":"helion","message":"–ü—Ä–∏–≤—ñ—Ç","mode":"chat"}'

{
  "data": {
    "text": "–ü—Ä–∏–≤—ñ—Ç! üòä –Ø —Ç—É—Ç, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏. –©–æ —Ç–∏ —Ö–æ—á–µ—à –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏?"
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Router —É—Å–ø—ñ—à–Ω–æ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ Ollama —Ç–∞ –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç–∏!

---

## üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Å–µ—Ä–≤—ñ—Å—ñ–≤

### ‚úÖ –ü—Ä–∞—Ü—é—é—á—ñ —Å–µ—Ä–≤—ñ—Å–∏

1. **Ollama**
   - URL: `http://0.0.0.0:11434` (–≤—Å—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏)
   - –ú–æ–¥–µ–ª—ñ: 5 –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö (qwen3:8b, qwen2.5:7b, —Ç–æ—â–æ)
   - GPU: ‚úÖ –ê–∫—Ç–∏–≤–Ω–∏–π (CUDA)
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy

2. **DAGI Router**
   - URL: `http://144.76.224.179:9102`
   - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Ollama: ‚úÖ –ü—Ä–∞—Ü—é—î
   - –ê–≥–µ–Ω—Ç–∏: helion, greenfood, yaromir, —Ç–æ—â–æ
   - –°—Ç–∞—Ç—É—Å: ‚úÖ Healthy

3. **Frontend**
   - –ß–∞—Ç –∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏: ‚úÖ –ü—Ä–∞—Ü—é—î
   - Fallback –æ–±—Ä–æ–±–∫–∞: ‚úÖ –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞
   - –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Router: ‚úÖ –ü—Ä–∞—Ü—é—î

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –î–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:
- ‚ùå Router –Ω–µ –º—ñ–≥ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ Ollama
- ‚ùå –ü–æ–º–∏–ª–∫–∞: "Provider error: All connection attempts failed"
- ‚ùå –ß–∞—Ç –ø–æ–∫–∞–∑—É–≤–∞–≤ —Ç—ñ–ª—å–∫–∏ fallback –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

### –ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:
- ‚úÖ Router —É—Å–ø—ñ—à–Ω–æ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ Ollama
- ‚úÖ –ê–≥–µ–Ω—Ç–∏ (helion, greenfood, yaromir) –ø—Ä–∞—Ü—é—é—Ç—å
- ‚úÖ –ß–∞—Ç –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∞–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ LLM
- ‚úÖ –ú–æ–¥–µ–ª—å qwen3:8b –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ

---

## üìù –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Router

**–§–∞–π–ª:** `/opt/dagi-router/router-config.yml`

```yaml
llm_profiles:
  local_qwen3_8b:
    provider: ollama
    base_url: http://172.17.0.1:11434  # ‚úÖ –ü—Ä–∞—Ü—é—î –∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
    model: qwen3:8b
    max_tokens: 1024
    temperature: 0.2
    top_p: 0.9
    timeout_ms: 30000

agents:
  helion:
    description: "Helion - AI agent for Energy Union platform"
    default_llm: local_qwen3_8b  # ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Ollama
    system_prompt: |
      –¢–∏ - Helion, AI-–∞–≥–µ–Ω—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ Energy Union.
      ...
```

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

1. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**
   - –î–æ–¥–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Ollama (Prometheus)
   - –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —á–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Router

2. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**
   - –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ connection pooling –¥–ª—è Ollama
   - –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π

3. **–ë–µ–∑–ø–µ–∫–∞**
   - –û–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ Ollama —Ç—ñ–ª—å–∫–∏ –∑ Docker –º–µ—Ä–µ–∂—ñ
   - –î–æ–¥–∞—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

LLM —Å–µ—Ä–≤—ñ—Å–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ —Ç–∞ –ø—Ä–∞—Ü—é—é—Ç—å:
- ‚úÖ Ollama –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
- ‚úÖ Router –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ Ollama
- ‚úÖ –ê–≥–µ–Ω—Ç–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å –∑–∞–ø–∏—Ç–∏ —á–µ—Ä–µ–∑ LLM
- ‚úÖ –ß–∞—Ç –ø—Ä–∞—Ü—é—î –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è!** üéâ




