# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Monitor Agent

**–î–∞—Ç–∞:** 2025-11-23  
**–ü—Ä–æ–±–ª–µ–º–∞:** Monitor Agent Service –ø–æ–≤–µ—Ä—Ç–∞—î 500 Internal Server Error –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

## üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º–∏

### –í–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏:

1. ‚úÖ **Monitor Agent Service –ø—Ä–∞—Ü—é—î** –Ω–∞ –ø–æ—Ä—Ç—É 9500
   - Health check: `http://localhost:9500/health` ‚Üí `{"status":"ok"}`
   - –ü—Ä–æ—Ü–µ—Å: Python (PID: 17336)

2. ‚ùå **Ollama –Ω–∞ –ù–û–î–ê2 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π**
   - URL: `http://192.168.1.244:11434`
   - –ü–æ–º–∏–ª–∫–∞: Connection refused / Timeout

3. ‚úÖ **Ollama –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∞—Ü—é—î**
   - URL: `http://localhost:11434`
   - –î–æ—Å—Ç—É–ø–Ω—ñ –º–æ–¥–µ–ª—ñ: `mistral-nemo:12b`, `gpt-oss:latest`, `gemma2:27b`, —Ç–æ—â–æ

### –ü—Ä–∏—á–∏–Ω–∞ –ø–æ–º–∏–ª–∫–∏:

Monitor Agent Service –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –Ω–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Ollama –Ω–∞ –ù–û–î–ê2 (`192.168.1.244:11434`), –∞–ª–µ:
- –ù–û–î–ê2 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ –ª–æ–∫–∞–ª—å–Ω–æ—ó –º–∞—à–∏–Ω–∏
- Ollama –ø—Ä–∞—Ü—é—î –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ `localhost:11434`

–ö–æ–ª–∏ Monitor Agent Service –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç –¥–æ Ollama –Ω–∞ –ù–û–î–ê2, –≤—ñ–Ω –æ—Ç—Ä–∏–º—É—î –ø–æ–º–∏–ª–∫—É –∑'—î–¥–Ω–∞–Ω–Ω—è, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ 500 Internal Server Error.

## ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –ó–º—ñ–Ω–µ–Ω–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

**–§–∞–π–ª:** `services/monitor-agent-service/app/main.py`

```python
# –ë—É–ª–æ:
OLLAMA_BASE_URL = os.getenv("OLLAMA_BASE_URL", "http://192.168.1.244:11434")  # –ù–û–î–ê2
MISTRAL_MODEL = os.getenv("MISTRAL_MODEL", "mistral:7b")

# –°—Ç–∞–ª–æ:
OLLAMA_BASE_URL = os.getenv("OLLAMA_BASE_URL", "http://localhost:11434")  # –õ–æ–∫–∞–ª—å–Ω–∏–π Ollama
MISTRAL_MODEL = os.getenv("MISTRAL_MODEL", "mistral-nemo:12b")  # –î–æ—Å—Ç—É–ø–Ω–∞ –º–æ–¥–µ–ª—å
```

### 2. –î–æ–¥–∞–Ω–æ fallback –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ –º–æ–¥–µ–ª—ñ

–Ø–∫—â–æ –≤–∫–∞–∑–∞–Ω–∞ –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, —Å–µ—Ä–≤—ñ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–±—É—î —ñ–Ω—à—ñ:
1. `mistral-nemo:12b` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
2. `gpt-oss:latest`
3. `mistral:7b`
4. `mistral:latest`

### 3. –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

- –î–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ –º–æ–¥–µ–ª—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ—ó –º–æ–¥–µ–ª—ñ

## üöÄ –Ø–∫ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å (—è–∫—â–æ –∑–∞–ø—É—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ uvicorn)

```bash
# –ó–Ω–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å
ps aux | grep "uvicorn.*monitor-agent"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å
cd services/monitor-agent-service
source venv/bin/activate  # –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è venv
python -m uvicorn app.main:app --host 0.0.0.0 --port 9500 --reload
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ environment variables

```bash
# –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –ù–û–î–ê2
export OLLAMA_BASE_URL=http://192.168.1.244:11434

# –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—à—É –º–æ–¥–µ–ª—å
export MISTRAL_MODEL=mistral:7b

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Å–µ—Ä–≤—ñ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–≤—Å—è

–Ø–∫—â–æ —Å–µ—Ä–≤—ñ—Å –∑–∞–ø—É—â–µ–Ω–∏–π –∑ `--reload`, –≤—ñ–Ω –º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏—Å—è –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ —Ñ–∞–π–ª—É.

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

1. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ health check:**
   ```bash
   curl http://localhost:9500/health
   ```
   –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏: `{"status":"ok","service":"monitor-agent-service"}`

2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Ollama:**
   ```bash
   curl http://localhost:11434/api/tags
   ```
   –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π

3. **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —á–∞—Ç:**
   ```bash
   curl -X POST http://localhost:9500/api/agent/monitor/chat \
     -H "Content-Type: application/json" \
     -d '{"agent_id":"monitor","message":"–ü—Ä–∏–≤—ñ—Ç!","node_id":null}'
   ```
   –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Monitor Agent

4. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤ UI:**
   - –í—ñ–¥–∫—Ä–∏—Ç–∏ `http://localhost:8899/dagi-monitor`
   - –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Monitor Agent Chat
   - –ú–∞—î –∑'—è–≤–∏—Ç–∏—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑–∞–º—ñ—Å—Ç—å –ø–æ–º–∏–ª–∫–∏

## üìù –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â

### –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
```bash
OLLAMA_BASE_URL=http://localhost:11434
MISTRAL_MODEL=mistral-nemo:12b
```

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ù–û–î–ê2
```bash
OLLAMA_BASE_URL=http://192.168.1.244:11434
MISTRAL_MODEL=mistral:7b
```

### Production (—è–∫—â–æ Ollama –Ω–∞ —ñ–Ω—à–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ)
```bash
OLLAMA_BASE_URL=http://ollama-server:11434
MISTRAL_MODEL=mistral:latest
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
- ‚úÖ Monitor Agent Service –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Ollama
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ –º–æ–¥–µ–ª—ñ
- ‚úÖ –ß–∞—Ç –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ 500
- ‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ Monitor Agent –∑'—è–≤–ª—è—é—Ç—å—Å—è –≤ UI

## üîÑ –Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞—Ü—é—î Ollama:
   ```bash
   curl http://localhost:11434/api/tags
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Monitor Agent Service:
   ```bash
   # –Ø–∫—â–æ –∑–∞–ø—É—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ uvicorn, –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ
   # –ê–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–æ—Ü–µ—Å
   ps aux | grep uvicorn
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ environment variables:
   ```bash
   echo $OLLAMA_BASE_URL
   echo $MISTRAL_MODEL
   ```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏:
   ```bash
   export OLLAMA_BASE_URL=http://localhost:11434
   export MISTRAL_MODEL=mistral-nemo:12b
   python -m uvicorn app.main:app --host 0.0.0.0 --port 9500 --reload
   ```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ  
**–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ Monitor Agent Service –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω

