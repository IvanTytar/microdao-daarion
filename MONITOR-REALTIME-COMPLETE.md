# ‚úÖ Monitor Agent - Real-time —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–î–∞—Ç–∞:** 2025-11-22  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

---

## üéâ –í–∏–∫–æ–Ω–∞–Ω–æ

### ‚úÖ 1. Event Logging System
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–º—ñ–Ω
- ‚úÖ –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 1000 –ø–æ–¥—ñ–π
- ‚úÖ API endpoint: `/api/events`
- ‚úÖ –û—á–∏—â–µ–Ω–Ω—è –ª–æ–≥—É: `POST /api/events/clear`

### ‚úÖ 2. Real-time Updates
- ‚úÖ WebSocket endpoint: `/ws/events`
- ‚úÖ Server-Sent Events: `/api/events/stream`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ dashboard
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—è

### ‚úÖ 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ Background task –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–æ–¥ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Swapper Service –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –∑–º—ñ–Ω

### ‚úÖ 4. Event Log –Ω–∞ Dashboard
- ‚úÖ –°–µ–∫—Ü—ñ—è "System Activity Log"
- ‚úÖ –û—Å—Ç–∞–Ω–Ω—ñ 20 –ø–æ–¥—ñ–π
- ‚úÖ Real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ Polling fallback –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥
- ‚úÖ –í—ñ–∑—É–∞–ª—å–Ω—ñ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ (Agent/Node/System)

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞

### 1. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–¥
**–ü—Ä–∞–≤–∏–ª–æ:** –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Å—Ç–∞—Ç—É—Å –∫–æ–∂–Ω–æ—ó –Ω–æ–¥–∏ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥

**–î—ñ—ó:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ health endpoint
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —Å—Ç–∞—Ç—É—Å–æ–º
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—É
- Broadcast –ø–æ–¥—ñ—ó —á–µ—Ä–µ–∑ WebSocket

**–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–¥—ñ—ó:**
```json
{
  "type": "node",
  "action": "status_changed",
  "message": "–°—Ç–∞—Ç—É—Å –Ω–æ–¥–∏ NODE 1 (Production) –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ offline",
  "details": {
    "node_id": "node-1",
    "previous_status": "online",
    "new_status": "offline"
  }
}
```

### 2. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–≥–µ–Ω—Ç—ñ–≤
**–ü—Ä–∞–≤–∏–ª–æ:** –õ–æ–≥—É–≤–∞—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏ –≤ –∞–≥–µ–Ω—Ç–∞—Ö

**–î—ñ—ó:**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–≥–µ–Ω—Ç–∞
- –î–æ–¥–∞–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑ –∫–æ–º–∞–Ω–¥–∏
- –ó–º—ñ–Ω–∞ system prompt

**–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–¥—ñ—ó:**
```json
{
  "type": "agent",
  "action": "sub_agent_added",
  "message": "–î–æ–¥–∞–Ω–æ –∞–≥–µ–Ω—Ç–∞ 'Product Manager' –≤ –∫–æ–º–∞–Ω–¥—É GREENFOOD Assistant",
  "details": {
    "agent_id": "greenfood",
    "agent_name": "GREENFOOD Assistant",
    "sub_agent": {
      "name": "Product Manager",
      "role": "Manages products"
    }
  }
}
```

### 3. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ Swapper Service
**–ü—Ä–∞–≤–∏–ª–æ:** –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ Swapper Service –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥

**–î—ñ—ó:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É Swapper Service
- –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω –∞–∫—Ç–∏–≤–Ω–æ—ó –º–æ–¥–µ–ª—ñ
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å

**–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–¥—ñ—ó:**
```json
{
  "type": "node",
  "action": "swapper_updated",
  "message": "–û–Ω–æ–≤–ª–µ–Ω–æ Swapper Service –Ω–∞ –Ω–æ–¥—ñ NODE 2 (Local)",
  "details": {
    "node_id": "node-2",
    "previous_model": null,
    "current_model": "deepseek-r1-70b"
  }
}
```

---

## üìä Event Log –Ω–∞ Dashboard

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

1. **–°–µ–∫—Ü—ñ—è "System Activity Log":**
   - –†–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–¥ –∫–∞—Ä—Ç–∫–∞–º–∏ –Ω–æ–¥
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Å–æ—Ç–∞: 256px (max-h-64)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–æ–∫—Ä—É—á—É–≤–∞–Ω–Ω—è

2. **–§–æ—Ä–º–∞—Ç –ø–æ–¥—ñ—ó:**
   - üîµ Agent events (blue icon)
   - üü¢ Node events (green icon)
   - üü£ System events (purple icon)
   - –ß–∞—Å –ø–æ–¥—ñ—ó
   - –î–µ—Ç–∞–ª—ñ (—è–∫—â–æ —î)

3. **Real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:**
   - WebSocket –¥–ª—è –º–∏—Ç—Ç—î–≤–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
   - Polling –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥ (fallback)
   - –ê–Ω—ñ–º–∞—Ü—ñ—è pulse –¥–ª—è –Ω–æ–≤–∏—Ö –ø–æ–¥—ñ–π

---

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### Event Log Structure

```python
EVENT_LOG = deque(maxlen=1000)  # –û—Å—Ç–∞–Ω–Ω—ñ 1000 –ø–æ–¥—ñ–π
```

### Event Format

```python
{
    "timestamp": "2025-11-22T12:34:56.789",
    "type": "agent" | "node" | "system",
    "action": "created" | "updated" | "deleted" | "status_changed" | ...,
    "message": "Human-readable message",
    "details": {
        # –î–µ—Ç–∞–ª—ñ –ø–æ–¥—ñ—ó
    }
}
```

### WebSocket Connection

```javascript
const ws = new WebSocket('ws://localhost:8899/ws/events');
ws.onmessage = (event) => {
    const eventData = JSON.parse(event.data);
    addEventToLog(eventData);
};
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Event Log API

```bash
# –û—Ç—Ä–∏–º–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –ø–æ–¥—ñ—ó
curl 'http://localhost:8899/api/events?limit=10'

# –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥
curl -X POST http://localhost:8899/api/events/clear
```

### 2. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –ø–æ–¥—ñ—é

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–∞–±—ñ–Ω–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞: `/agent/greenfood`
2. –î–æ–¥–∞—Ç–∏ –∞–≥–µ–Ω—Ç–∞ –≤ –∫–æ–º–∞–Ω–¥—É
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ Event Log –Ω–∞ dashboard

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ dashboard
2. –í—ñ–¥–∫—Ä–∏—Ç–∏ DevTools ‚Üí Network ‚Üí WS
3. –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ `/ws/events`
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–¥—ñ—é (–¥–æ–¥–∞—Ç–∏ –∞–≥–µ–Ω—Ç–∞)
5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–¥—ñ—ó —á–µ—Ä–µ–∑ WebSocket

---

## üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ (—è–∫ –ø—Ä–∞—Ü—é—é—Ç—å)

### –ü—Ä–∞–≤–∏–ª–æ 1: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—É –Ω–æ–¥
```
IF node.status != previous_status THEN
    log_event("node", "status_changed", {...})
    broadcast_event(event)
END
```

### –ü—Ä–∞–≤–∏–ª–æ 2: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–º—ñ–Ω –≤ –∞–≥–µ–Ω—Ç–∞—Ö
```
WHEN agent.updated OR agent.sub_agent_added OR agent.sub_agent_removed THEN
    log_event("agent", action, {...})
    broadcast_event(event)
END
```

### –ü—Ä–∞–≤–∏–ª–æ 3: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ Swapper Service
```
IF swapper.active_model != previous_active_model THEN
    log_event("node", "swapper_updated", {...})
    broadcast_event(event)
END
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

**Monitor Agent –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –∑ —Å–∏—Å—Ç–µ–º–æ—é!** üéâ

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–º—ñ–Ω
- ‚úÖ Real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ Event Log –Ω–∞ dashboard
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–¥ —Ç–∞ –∞–≥–µ–Ω—Ç—ñ–≤
- ‚úÖ Background task –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∑–º—ñ–Ω

**–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑!**

---

**Last Updated:** 2025-11-22  
**Status:** ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è  
**URL:** `http://localhost:8899`

