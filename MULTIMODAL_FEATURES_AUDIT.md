# üé® –ê—É–¥–∏—Ç –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–∏—Ö –§—É–Ω–∫—Ü—ñ–π –¥–ª—è Telegram –ë–æ—Ç—ñ–≤

**–î–∞—Ç–∞:** 2025-11-24  
**NODE1:** 144.76.224.179  
**–í—Å—å–æ–≥–æ –±–æ—Ç—ñ–≤:** 9  

---

## üìä –ü—ñ–¥—Å—É–º–æ–∫ —Å—Ç–∞—Ç—É—Å—É

| –§—É–Ω–∫—Ü—ñ—è | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª—ñ | –ë–æ—Ç–∏ |
|---------|--------|--------|------|
| **üé§ Voice (STT)** | ‚úÖ –ü–†–ê–¶–Æ–Ñ | Whisper base, –≤—Å—ñ –±–æ—Ç–∏ | 9/9 |
| **üîä Voice Reply (TTS)** | ‚úÖ –ü–†–ê–¶–Æ–Ñ | gTTS, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–µ–∂–∏–º | 9/9 |
| **üì∏ Photo (Vision)** | ‚úÖ –ü–†–ê–¶–Æ–Ñ | specialist_vision_8b —á–µ—Ä–µ–∑ Router | 9/9 |
| **üìÑ Documents (PDF)** | ‚úÖ –ü–†–ê–¶–Æ–Ñ | Parser Service | 9/9 |
| **üîç Web Search** | ‚ùå –ù–ï –Ü–ù–¢–ï–ì–†–û–í–ê–ù–û | –°–µ—Ä–≤—ñ—Å –≥–æ—Ç–æ–≤–∏–π, –ø–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è | 0/9 |
| **üñºÔ∏è OCR** | ‚ö†Ô∏è –ß–ê–°–¢–ö–û–í–û | –°–µ—Ä–≤—ñ—Å unhealthy (torch error) | - |

---

## ‚úÖ –©–æ –ø—Ä–∞—Ü—é—î

### 1. üé§ **Voice Messages (STT)** ‚Äî –ü–û–í–ù–Ü–°–¢–Æ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö 9 –±–æ—Ç—ñ–≤

**–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—è:** OpenAI Whisper (base model)  
**–°–µ—Ä–≤—ñ—Å:** `dagi-stt-service` (–ø–æ—Ä—Ç 8895)  
**URL:** `http://172.21.0.19:8895`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:**
- –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó, –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó, —Ä–æ—Å—ñ–π—Å—å–∫–æ—ó
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü—ñ—è
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞: voice messages, audio files, video notes

**–¢–µ—Å—Ç:**
```
User ‚Üí üé§ "–ü—Ä–∏–≤—ñ—Ç!"
Bot  ‚Üí üìù [STT —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —Ç–µ–∫—Å—Ç]
Bot  ‚Üí üí¨ –û–±—Ä–æ–±–ª—è—î —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î
```

---

### 2. üîä **Voice Replies (TTS)** ‚Äî –ü–û–í–ù–Ü–°–¢–Æ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö 9 –±–æ—Ç—ñ–≤

**–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—è:** gTTS (Google Text-to-Speech)  
**–°–µ—Ä–≤—ñ—Å:** `dagi-tts` (–ø–æ—Ä—Ç 5002)  
**URL:** `http://dagi-tts:5002`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≥–æ–ª–æ—Å–æ–º –Ω–∞ –≥–æ–ª–æ—Å–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –£–Ω—ñ–∫–∞–ª—å–Ω—ñ –≥–æ–ª–æ—Å–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–æ—Ç–∞ (—Ä—ñ–∑–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å)
- Fallback –¥–æ —Ç–µ–∫—Å—Ç—É —è–∫—â–æ TTS –Ω–µ –≤–¥–∞—î—Ç—å—Å—è
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó —Ç–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó

**–¢–µ—Å—Ç:**
```
User ‚Üí üé§ [Voice: "–Ø–∫ —Å–ø—Ä–∞–≤–∏?"]
     ‚Üì STT
Bot  ‚Üí üìù "–Ø–∫ —Å–ø—Ä–∞–≤–∏?"
     ‚Üì LLM
Bot  ‚Üí üîä [Voice reply via TTS]
```

---

### 3. üì∏ **Photo Processing (Vision)** ‚Äî –ü–û–í–ù–Ü–°–¢–Æ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö 9 –±–æ—Ç—ñ–≤

**–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—è:** `specialist_vision_8b` —á–µ—Ä–µ–∑ Router  
**–ú–æ–¥–µ–ª—å:** qwen3-vl:8b (—á–µ—Ä–µ–∑ Swapper)

**–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è:** `/opt/microdao-daarion/gateway-bot/http_api.py`
- **–§—É–Ω–∫—Ü—ñ—è:** `async def process_photo()` (–ª—ñ–Ω—ñ—è 406)
- **–í–∏–∫–ª–∏–∫:** –í webhook handler (–ª—ñ–Ω—ñ—è 850)

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:**
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ –∑ Telegram
- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Router –∑ `use_llm: specialist_vision_8b`
- –û–ø–∏—Å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é/–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Memory –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

**–Ø–∫ –ø—Ä–∞—Ü—é—î:**
```python
# Gateway –æ—Ç—Ä–∏–º—É—î —Ñ–æ—Ç–æ
photo = update.message.get("photo")

# –û–±—Ä–æ–±–∫–∞
result = await process_photo(
    agent_config, update, chat_id, user_id, username, dao_id, photo
)

# –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Router
router_request = {
    "message": f"–û–ø–∏—à–∏ —Ü–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ: {file_url}",
    "metadata": {
        "has_image": True,
        "use_llm": "specialist_vision_8b",
        "file_url": file_url,
    }
}

# –í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
await send_telegram_message(
    chat_id,
    f"‚úÖ **–§–æ—Ç–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ**\n\n{answer_text}",
    telegram_token
)
```

**–¢–µ—Å—Ç:**
```
User ‚Üí üì∏ [–ù–∞–¥—Å–∏–ª–∞—î —Ñ–æ—Ç–æ]
Bot  ‚Üí "‚úÖ –§–æ—Ç–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ"
Bot  ‚Üí "–ù–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ: [–¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å]"
```

---

### 4. üìÑ **Document Processing (PDF)** ‚Äî –ü–û–í–ù–Ü–°–¢–Æ –§–£–ù–ö–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö 9 –±–æ—Ç—ñ–≤

**–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è:** `/opt/microdao-daarion/gateway-bot/http_api.py`
- **–§—É–Ω–∫—Ü—ñ—è:** `async def process_document()` (—ñ—Å–Ω—É—î)
- **–í–∏–∫–ª–∏–∫:** –í webhook handler (–ª—ñ–Ω—ñ—è 840)

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:**
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PDF/–¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ Telegram
- –ü–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ Parser Service
- –í–∏—Ç—è–≥ —Ç–µ–∫—Å—Ç—É –∑ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

**–¢–µ—Å—Ç:**
```
User ‚Üí üìÑ [–ù–∞–¥—Å–∏–ª–∞—î PDF]
Bot  ‚Üí "üìÑ –û–±—Ä–æ–±–ª—è—é –¥–æ–∫—É–º–µ–Ω—Ç..."
Bot  ‚Üí [–û–ø–∏—Å –≤–º—ñ—Å—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞]
```

---

## ‚ùå –©–æ –ù–ï –ø—Ä–∞—Ü—é—î

### 1. üîç **Web Search** ‚Äî –ù–ï –Ü–ù–¢–ï–ì–†–û–í–ê–ù–û

**–°—Ç–∞—Ç—É—Å:** ‚ùå –°–µ—Ä–≤—ñ—Å –≥–æ—Ç–æ–≤–∏–π, –∞–ª–µ –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ Gateway

**–°–µ—Ä–≤—ñ—Å:** `dagi-web-search-service`  
**–ü–æ—Ä—Ç:** 8897  
**URL:** `http://localhost:8897`  
**–°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:** Up (unhealthy —á–µ—Ä–µ–∑ rate limit)

**–©–æ —î:**
- ‚úÖ Web Search Service –∑–∞–ø—É—â–µ–Ω–∏–π
- ‚úÖ DuckDuckGo —Ç–∞ Google –¥–æ—Å—Ç—É–ø–Ω—ñ
- ‚úÖ API endpoints –ø—Ä–∞—Ü—é—é—Ç—å:
  - `POST /api/search`
  - `GET /api/search?query=...`
  - `GET /health`

**–©–æ –ù–ï –∑—Ä–æ–±–ª–µ–Ω–æ:**
- ‚ùå –ù–µ–º–∞—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≤ Gateway
- ‚ùå –ë–æ—Ç–∏ –Ω–µ –º–æ–∂—É—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ web search
- ‚ùå –ù–µ–º–∞—î –∫–æ–º–∞–Ω–¥–∏ `/search` –∞–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞:** Rate limit –≤—ñ–¥ DuckDuckGo
```json
{
  "detail": "DuckDuckGo error: Ratelimit"
}
```

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Google —è–∫ fallback –∞–±–æ –¥–æ–¥–∞—Ç–∏ –∑–∞—Ç—Ä–∏–º–∫–∏ –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏

---

### 2. üñºÔ∏è **OCR Service** ‚Äî UNHEALTHY

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –°–µ—Ä–≤—ñ—Å –∑–∞–ø—É—â–µ–Ω–∏–π –∞–ª–µ unhealthy

**–°–µ—Ä–≤—ñ—Å:** `dagi-ocr-service`  
**–ü–æ—Ä—Ç:** 8896  
**URL:** `http://localhost:8896`

**–ü—Ä–æ–±–ª–µ–º–∞:** `NameError: name 'torch' is not defined`
```python
File "/app/app/main.py", line 99, in health
  "gpu": torch.cuda.is_available() if EASYOCR_AVAILABLE else False
         ^^^^^
NameError: name 'torch' is not defined
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í—ñ–¥—Å—É—Ç–Ω—ñ–π import torch –≤ `main.py`

**–°—Ç–∞—Ç—É—Å —Ä–æ–±–æ—Ç–∏:**
- ‚ö†Ô∏è Health endpoint –ø–∞–¥–∞—î –∑ 500
- ‚ùì OCR endpoints –º–æ–∂—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ (–ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
- ‚úÖ EasyOCR —Ç–∞ Tesseract –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ

**–†—ñ—à–µ–Ω–Ω—è:**
```python
# –î–æ–¥–∞—Ç–∏ –≤ /app/app/main.py
try:
    import torch
    TORCH_AVAILABLE = True
except ImportError:
    TORCH_AVAILABLE = False

# –í health endpoint:
"gpu": torch.cuda.is_available() if TORCH_AVAILABLE and EASYOCR_AVAILABLE else False
```

---

## üéØ –ü–ª–∞–Ω –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è Web Search

### –ú–µ—Ç–∞:
–í—Å—ñ 9 –±–æ—Ç—ñ–≤ –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —à—É–∫–∞—Ç–∏ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ.

### –í–∞—Ä—ñ–∞–Ω—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

#### –í–∞—Ä—ñ–∞–Ω—Ç A: –ö–æ–º–∞–Ω–¥–∞ `/search`
```
User ‚Üí /search DAARION MicroDAO
Bot  ‚Üí üîç –®—É–∫–∞—é –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ...
Bot  ‚Üí –ó–Ω–∞–π–¥–µ–Ω–æ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:
       1. [–¢–∏—Ç—É–ª](URL) - –æ–ø–∏—Å
       2. [–¢–∏—Ç—É–ª](URL) - –æ–ø–∏—Å
       ...
```

#### –í–∞—Ä—ñ–∞–Ω—Ç B: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è
```
User ‚Üí "–©–æ –Ω–æ–≤–æ–≥–æ –≤ AI?"
Bot  ‚Üí [–≤–∏—è–≤–ª—è—î –ø–æ—Ç—Ä–µ–±—É –≤ –∞–∫—Ç—É–∞–ª—å–Ω—ñ–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó]
Bot  ‚Üí üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é –æ—Å—Ç–∞–Ω–Ω—ñ –Ω–æ–≤–∏–Ω–∏...
Bot  ‚Üí –ó–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–º–∏ –¥–∞–Ω–∏–º–∏ –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É: ...
```

#### –í–∞—Ä—ñ–∞–Ω—Ç C: Explicit request
```
User ‚Üí "–ó–Ω–∞–π–¥–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–≤–∞–Ω—Ç–æ–≤—ñ –∫–æ–º–ø'—é—Ç–µ—Ä–∏"
Bot  ‚Üí [–≤–∏—è–≤–ª—è—î –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ "–∑–Ω–∞–π–¥–∏"]
Bot  ‚Üí üîç –®—É–∫–∞—é –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ...
Bot  ‚Üí –û—Å—å —â–æ —è –∑–Ω–∞–π—à–æ–≤: ...
```

---

### –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è Web Search

#### –ö—Ä–æ–∫ 1: –î–æ–¥–∞—Ç–∏ Web Search —Ñ—É–Ω–∫—Ü—ñ—é –≤ Gateway

**–§–∞–π–ª:** `/opt/microdao-daarion/gateway-bot/http_api.py`

```python
async def perform_web_search(
    query: str,
    max_results: int = 5,
    engine: str = "google"  # fallback –≤—ñ–¥ duckduckgo —á–µ—Ä–µ–∑ rate limit
) -> List[Dict[str, str]]:
    \"\"\"–í–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ—à—É–∫ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ\"\"\"
    try:
        web_search_url = os.getenv("WEB_SEARCH_SERVICE_URL", "http://dagi-web-search-service:8897")
        
        logger.info(f"üîç Web search: '{query}' via {engine}")
        
        payload = {
            "query": query,
            "engine": engine,
            "max_results": max_results,
            "region": "ua-uk"
        }
        
        async with httpx.AsyncClient(timeout=30.0) as client:
            resp = await client.post(
                f"{web_search_url}/api/search",
                json=payload
            )
            
            if resp.status_code == 200:
                data = resp.json()
                results = data.get("results", [])
                logger.info(f"‚úÖ Found {len(results)} results")
                return results
            else:
                # Fallback to Google if DuckDuckGo fails
                if engine == "duckduckgo":
                    logger.warning("DuckDuckGo failed, trying Google...")
                    return await perform_web_search(query, max_results, "google")
                else:
                    logger.error(f"Web search error: {resp.status_code}")
                    return []
                    
    except Exception as e:
        logger.error(f"Web search exception: {e}", exc_info=True)
        return []


def format_search_results(results: List[Dict[str, str]], query: str) -> str:
    \"\"\"–§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –¥–ª—è Telegram\"\"\"
    if not results:
        return f"üîç –ù–∞ –∂–∞–ª—å, –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ –∑–∞–ø–∏—Ç–æ–º: '{query}'"
    
    formatted = f"üîç **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É:** '{query}'\\n\\n"
    
    for i, result in enumerate(results[:5], 1):
        title = result.get("title", "No title")
        url = result.get("url", "")
        snippet = result.get("snippet", "")[:150]
        
        formatted += f"{i}. [{title}]({url})\\n"
        if snippet:
            formatted += f"   _{snippet}..._\\n\\n"
    
    return formatted
```

---

#### –ö—Ä–æ–∫ 2: –î–æ–¥–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `/search`

```python
# –í handle_telegram_webhook –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è text

# Check for /search command
if text.startswith("/search "):
    search_query = text[8:].strip()  # Remove "/search "
    
    if search_query:
        # –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ "—à—É–∫–∞—é..." –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        await send_telegram_message(
            chat_id,
            f"üîç –®—É–∫–∞—é –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ: '{search_query}'...",
            telegram_token
        )
        
        # –í–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ—à—É–∫
        search_results = await perform_web_search(search_query)
        
        # –§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
        formatted_results = format_search_results(search_results, search_query)
        
        await send_telegram_message(
            chat_id,
            formatted_results,
            telegram_token,
            parse_mode="Markdown"
        )
        
        return {"ok": True}
```

---

#### –ö—Ä–æ–∫ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–π–Ω–æ)

```python
# –í–∏—è–≤–∏—Ç–∏ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –¥–ª—è web search
web_search_keywords = [
    "–∑–Ω–∞–π–¥–∏", "–Ω–∞–π–¥–∏", "–ø–æ—à—É–∫–∞–π", "–ø–æ–∏—â–∏",
    "—â–æ –Ω–æ–≤–æ–≥–æ", "what's new", "–æ—Å—Ç–∞–Ω–Ω—ñ –Ω–æ–≤–∏–Ω–∏",
    "–∞–∫—Ç—É–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è", "current", "latest"
]

should_search_web = any(keyword in text.lower() for keyword in web_search_keywords)

if should_search_web:
    # –í–∏–∫–æ–Ω–∞—Ç–∏ web search —Ç–∞ –¥–æ–¥–∞—Ç–∏ –¥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    search_results = await perform_web_search(text, max_results=3)
    
    if search_results:
        # –î–æ–¥–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –¥–æ prompt
        search_context = "\\n".join([
            f"- {r['title']}: {r['snippet']}"
            for r in search_results[:3]
        ])
        
        router_request["message"] += f"\\n\\n–ê–∫—Ç—É–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É:\\n{search_context}"
        router_request["metadata"]["web_search_used"] = True
```

---

## üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è OCR

### –ü—Ä–æ–±–ª–µ–º–∞:
```python
NameError: name 'torch' is not defined
```

### –†—ñ—à–µ–Ω–Ω—è:

**–§–∞–π–ª:** `/services/ocr-service/app/main.py`

**–î–æ–¥–∞—Ç–∏ –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ñ–∞–π–ª—É:**
```python
try:
    import torch
    TORCH_AVAILABLE = True
except ImportError:
    TORCH_AVAILABLE = False
    logger.warning("‚ö†Ô∏è PyTorch not available")
```

**–û–Ω–æ–≤–∏—Ç–∏ health endpoint (–ª—ñ–Ω—ñ—è ~99):**
```python
@app.get("/health")
async def health():
    return {
        "status": "healthy",
        "engines": {
            "tesseract": "available" if TESSERACT_AVAILABLE else "unavailable",
            "easyocr": "available" if EASYOCR_AVAILABLE else "unavailable"
        },
        "gpu": torch.cuda.is_available() if TORCH_AVAILABLE else False
    }
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
```bash
docker restart dagi-ocr-service
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: Voice (STT + TTS) ‚úÖ
```
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ @DAARWIZZBot
2. –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≥–æ–ª–æ—Å–æ–≤–µ: "–ü—Ä–∏–≤—ñ—Ç!"
3. –û—Ç—Ä–∏–º–∞—Ç–∏ –≥–æ–ª–æ—Å–æ–≤—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞—Ü—é—î

---

### –¢–µ—Å—Ç 2: Photo (Vision) ‚úÖ
```
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ @SoulBot
2. –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ñ–æ—Ç–æ
3. –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–ø–∏—Å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
```
**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Bot ‚Üí ‚úÖ –§–æ—Ç–æ –æ–±—Ä–æ–±–ª–µ–Ω–æ

–ù–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ: [–¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –≤—ñ–¥ specialist_vision_8b]
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∞—Ü—é—î (–ø–æ—Ç—Ä–µ–±—É—î live —Ç–µ—Å—Ç—É)

---

### –¢–µ—Å—Ç 3: Web Search ‚ùå
```
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ @DAARWIZZBot
2. –ù–∞–¥—ñ—Å–ª–∞—Ç–∏: /search DAARION MicroDAO
3. –û—á—ñ–∫—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É
```
**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å:** ‚ùå –ö–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î—Ç—å—Å—è
**–ü—ñ—Å–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è:** ‚úÖ –ü–æ–∫–∞–∂–µ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑ DuckDuckGo/Google

---

### –¢–µ—Å—Ç 4: OCR ‚ö†Ô∏è
```bash
# –ü—Ä—è–º–∏–π —Ç–µ—Å—Ç OCR API
curl -X POST http://localhost:8896/api/ocr/upload \
  -F "file=@image_with_text.png" \
  -F "engine=easyocr"
```
**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è Health unhealthy, endpoints –º–æ–∂—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏

---

## üìã TODO List

### –í–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:
- [ ] **–í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ Web Search –∫–æ–º–∞–Ω–¥—É `/search`** (1-2 –≥–æ–¥)
- [ ] **–í–∏–ø—Ä–∞–≤–∏—Ç–∏ OCR health endpoint** (15 —Ö–≤)
- [ ] **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ Photo processing live** (10 —Ö–≤)

### –°–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:
- [ ] –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –¥–ª—è web search
- [ ] –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ OCR –¥–ª—è –≤–∏—Ç—è–≥—É —Ç–µ–∫—Å—Ç—É –∑ –∑–æ–±—Ä–∞–∂–µ–Ω—å
- [ ] –î–æ–¥–∞—Ç–∏ fallback Google ‚Üí DuckDuckGo –¥–ª—è web search

### –ù–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:
- [ ] –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è web search —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- [ ] –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ rate limits –¥–ª—è DuckDuckGo
- [ ] –î–æ–¥–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `/help` –∑ –ø–µ—Ä–µ–ª—ñ–∫–æ–º –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π

---

## ‚úÖ –ß–µ–∫–ª—ñ—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ

### –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–æ—Ç–∞ (9 –±–æ—Ç—ñ–≤):
- [x] Voice STT (–≥–æ–ª–æ—Å ‚Üí —Ç–µ–∫—Å—Ç)
- [x] Voice TTS (—Ç–µ–∫—Å—Ç ‚Üí –≥–æ–ª–æ—Å)
- [x] Photo Vision (specialist_vision_8b)
- [x] Document parsing
- [ ] Web Search (–ø–æ—Ç—Ä–µ–±—É—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó)
- [ ] OCR (–ø–æ—Ç—Ä–µ–±—É—î –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è)

---

## üéØ –ü—ñ–¥—Å—É–º–æ–∫

### –ü—Ä–∞—Ü—é—î (–≥–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è):
| –§—É–Ω–∫—Ü—ñ—è | –ë–æ—Ç–∏ | –ü—Ä–∏–º—ñ—Ç–∫–∏ |
|---------|------|----------|
| Voice STT | 9/9 | ‚úÖ Whisper base |
| Voice TTS | 9/9 | ‚úÖ gTTS, —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –≥–æ–ª–æ—Å–∏ |
| Photo Vision | 9/9 | ‚úÖ specialist_vision_8b |
| Documents | 9/9 | ‚úÖ Parser Service |

### –ü–æ—Ç—Ä–µ–±—É—î —Ä–æ–±–æ—Ç–∏:
| –§—É–Ω–∫—Ü—ñ—è | –°—Ç–∞—Ç—É—Å | –ß–∞—Å –Ω–∞ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è |
|---------|--------|---------------------|
| Web Search | ‚ùå –ù–µ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ | 1-2 –≥–æ–¥–∏–Ω–∏ |
| OCR | ‚ö†Ô∏è Unhealthy | 15 —Ö–≤–∏–ª–∏–Ω |

---

**–°—Ç–∞—Ç—É—Å:** üü° **4/6 –§–£–ù–ö–¶–Ü–ô –ü–†–ê–¶–Æ–Æ–¢–¨, 2 –ü–û–¢–†–ï–ë–£–Æ–¢–¨ –í–ü–†–û–í–ê–î–ñ–ï–ù–ù–Ø**

**Last Updated:** 2025-11-24  
**By:** Claude (Cursor AI Assistant)





