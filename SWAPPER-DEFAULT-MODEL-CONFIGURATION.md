# ‚öôÔ∏è –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º –¥–ª—è Swapper Service

**–î–∞—Ç–∞:** 2025-11-23  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

---

## üìã –ü–æ—Ç–æ—á–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞

### –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–±–µ–∑ `default_model`):
- ‚úÖ –í—Å—ñ –º–æ–¥–µ–ª—ñ –º–∞—é—Ç—å —Å—Ç–∞—Ç—É—Å `UNLOADED` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
- ‚úÖ –ú–æ–¥–µ–ª—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–ø–∏—Ç–æ–º
- ‚úÖ –ï–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤ (VRAM, RAM)
- ‚ö†Ô∏è –ü–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–º (—á–∞—Å –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)

### –ó `default_model` –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:
- ‚úÖ –í–∫–∞–∑–∞–Ω–∞ –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
- ‚úÖ –®–≤–∏–¥—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç
- ‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è VRAM –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è

---

## üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –§–∞–π–ª: `services/swapper-service/config/swapper_config.yaml`

```yaml
swapper:
  mode: single-active
  max_concurrent_models: 1
  model_swap_timeout: 300
  gpu_enabled: true
  metal_acceleration: false
  # –ú–æ–¥–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
  default_model: qwen3-8b  # –ú–æ–¥–µ–ª—å –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
```

### –í–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:

#### 1. –ë–µ–∑ –º–æ–¥–µ–ª—ñ –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º (–µ–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤)
```yaml
swapper:
  # default_model –Ω–µ –≤–∫–∞–∑–∞–Ω–æ - –º–æ–¥–µ–ª—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–ø–∏—Ç–æ–º
  mode: single-active
```

#### 2. –û—Å–Ω–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º (—à–≤–∏–¥–∫—ñ—Å—Ç—å)
```yaml
swapper:
  default_model: qwen3-8b  # –û—Å–Ω–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å (4.87 GB)
```

#### 3. –õ–µ–≥–∫–∞ –º–æ–¥–µ–ª—å –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º (–±–∞–ª–∞–Ω—Å)
```yaml
swapper:
  default_model: qwen2.5-3b-instruct  # –õ–µ–≥–∫–∞ –º–æ–¥–µ–ª—å (1.80 GB)
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –î–ª—è –ù–û–î–ê1 (Production):
**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:** `default_model: qwen3-8b`

**–ü—Ä–∏—á–∏–Ω–∏:**
- –û—Å–Ω–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤
- –®–≤–∏–¥—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç
- 4.87 GB VRAM - –ø—Ä–∏–π–Ω—è—Ç–Ω–æ –¥–ª—è RTX 4000 SFF Ada (20GB)

### –î–ª—è –ù–û–î–ê2 (Development):
**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:** –ë–µ–∑ `default_model` –∞–±–æ `qwen2.5-3b-instruct`

**–ü—Ä–∏—á–∏–Ω–∏:**
- –ï–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –Ω–∞ —Ä–æ–∑—Ä–æ–±–Ω–∏—Ü—å–∫—ñ–π –º–∞—à–∏–Ω—ñ
- –õ–µ–≥–∫–∞ –º–æ–¥–µ–ª—å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë–µ–∑ default_model | –ó default_model |
|----------|-------------------|-----------------|
| **VRAM –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ** | 0 GB | 4.87 GB (qwen3-8b) |
| **–ß–∞—Å –ø–µ—Ä—à–æ–≥–æ –∑–∞–ø–∏—Ç—É** | ~10-30 —Å–µ–∫ (–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è) | ~1-2 —Å–µ–∫ (–≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞) |
| **–ï–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤** | ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ | ‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–∞–≤—ñ—Ç—å –±–µ–∑ –∑–∞–ø–∏—Ç—ñ–≤ |
| **–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ** | ‚ö†Ô∏è –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ –Ω–∞ –ø–µ—Ä—à–æ–º—É –∑–∞–ø–∏—Ç—ñ | ‚úÖ –®–≤–∏–¥—à–µ |

---

## üîÑ –Ø–∫ –ø—Ä–∞—Ü—é—î

### –ü—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ Swapper Service:

1. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:**
   ```python
   config = yaml.safe_load(f)
   swapper_config = config.get('swapper', {})
   default_model = swapper_config.get('default_model')
   ```

2. **–Ø–∫—â–æ `default_model` –≤–∫–∞–∑–∞–Ω–æ:**
   ```python
   if default_model and default_model in self.models:
       logger.info(f"üîÑ Loading default model: {default_model}")
       success = await self.load_model(default_model)
   ```

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ú–æ–¥–µ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –≤ VRAM
   - `active_model` = `default_model`
   - –°—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª—ñ = `LOADED`
   - –ì–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

---

## üõ†Ô∏è –ó–º—ñ–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### –í–∏–º–∫–Ω—É—Ç–∏ –º–æ–¥–µ–ª—å –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º:

```yaml
swapper:
  mode: single-active
  # default_model: qwen3-8b  # –ó–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ - –º–æ–¥–µ–ª—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–ø–∏—Ç–æ–º
```

### –ó–º—ñ–Ω–∏—Ç–∏ –º–æ–¥–µ–ª—å –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º:

```yaml
swapper:
  default_model: qwen2.5-3b-instruct  # –õ–µ–≥–∫–∞ –º–æ–¥–µ–ª—å –∑–∞–º—ñ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ—ó
```

### –ü—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ
ssh root@144.76.224.179
cd /opt/microdao-daarion
docker-compose restart swapper-service
```

---

## üìù –õ–æ–≥–∏

### –ü—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –∑ default_model:

```
üîß Initializing Swapper Service...
‚úÖ Loaded 5 models into Swapper
‚úÖ Swapper Service initialized with 5 models
üîÑ Loading default model: qwen3-8b
‚úÖ Default model loaded: qwen3-8b
```

### –ü—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ –±–µ–∑ default_model:

```
üîß Initializing Swapper Service...
‚úÖ Loaded 5 models into Swapper
‚úÖ Swapper Service initialized with 5 models
# –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
```

---

## ‚úÖ –í–∏—Å–Ω–æ–≤–æ–∫

**–ü–æ—Ç–æ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**
- ‚úÖ –ú–æ–¥–µ–ª—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–ø–∏—Ç–æ–º (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
- ‚úÖ –ú–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏ `default_model` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- ‚úÖ –ì–Ω—É—á–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø—ñ–¥ —Ä—ñ–∑–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è –¥–ª—è –ù–û–î–ê1:**
- –î–æ–¥–∞—Ç–∏ `default_model: qwen3-8b` –¥–ª—è —à–≤–∏–¥—à–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- –ê–±–æ –∑–∞–ª–∏—à–∏—Ç–∏ –±–µ–∑ `default_model` –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó —Ä–µ—Å—É—Ä—Å—ñ–≤

---

**–û–Ω–æ–≤–ª–µ–Ω–æ:** 2025-11-23  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è




