# Swapper Service - Setup Guide for Node #2

**Version:** 1.0.0  
**Date:** 2025-11-22  
**Status:** ‚úÖ Ready for Deployment

---

## ‚úÖ –©–æ –±—É–ª–æ –∑—Ä–æ–±–ª–µ–Ω–æ

### 1. –°—Ç–≤–æ—Ä–µ–Ω–æ Swapper Service
- ‚úÖ –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Å–µ—Ä–≤—ñ—Å—É (`app/main.py`)
- ‚úÖ API endpoints –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ Cabinet API –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –∫–∞–±—ñ–Ω–µ—Ç–∞—Ö (`app/cabinet_api.py`)
- ‚úÖ Dockerfile —Ç–∞ requirements.txt
- ‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª (`config/swapper_config.yaml`)
- ‚úÖ –î–æ–¥–∞–Ω–æ –≤ `docker-compose.yml`

### 2. –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
- ‚úÖ –î–∏–Ω–∞–º—ñ—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è/–≤–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π
- ‚úÖ Single-active mode (–æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞ —Ä–∞–∑)
- ‚úÖ –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è uptime –º–æ–¥–µ–ª–µ–π (–≤ –≥–æ–¥–∏–Ω–∞—Ö)
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ (request count, uptime, load/unload times)
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Ollama
- ‚úÖ API –¥–ª—è –∫–∞–±—ñ–Ω–µ—Ç—ñ–≤ Node #1 —Ç–∞ Node #2

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- ‚úÖ README.md –∑ –ø–æ–≤–Ω–∏–º –æ–ø–∏—Å–æ–º API
- ‚úÖ SWAPPER-CABINET-INTEGRATION.md –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
- ‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ vLLM vs Swapper

---

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ Swapper Service –Ω–∞ Node #2

```bash
cd /Users/apple/github-projects/microdao-daarion

# Build —Ç–∞ –∑–∞–ø—É—Å–∫
docker-compose up -d swapper-service

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
curl http://localhost:8890/health

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –¥–ª—è –∫–∞–±—ñ–Ω–µ—Ç—É
curl http://localhost:8890/api/cabinet/swapper/status
```

### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

```bash
# –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
curl http://localhost:8890/models

# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–æ–¥–µ–ª—å
curl -X POST http://localhost:8890/models/deepseek-r1-70b/load

# –°—Ç–∞—Ç—É—Å
curl http://localhost:8890/status

# –ú–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8890/metrics
```

---

## üìä –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è

### 1. –ß–∏ –ø—Ä–∞—Ü—é—î Swapper –Ω–∞ Node #2?

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –¢–µ–ø–µ—Ä —Ç–∞–∫! Swapper Service —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –≥–æ—Ç–æ–≤–∏–π –¥–æ –∑–∞–ø—É—Å–∫—É.

**–Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∑–∞–ø—É—â–µ–Ω–∏–π
docker ps | grep swapper-service

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ health
curl http://localhost:8890/health
```

### 2. –ó–∞ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ 1 –º–æ–¥–µ–ª—å?

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –¢–∞–∫, –≤ —Ä–µ–∂–∏–º—ñ `single-active` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞ —Ä–∞–∑. –¶–µ –æ–ø—Ç–∏–º—ñ–∑—É—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ.

**–Ø–∫ –∑–º—ñ–Ω–∏—Ç–∏:**
```yaml
# config/swapper_config.yaml
swapper:
  mode: multi-active  # –î–æ–∑–≤–æ–ª–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ –º–æ–¥–µ–ª–µ–π –æ–¥–Ω–æ—á–∞—Å–Ω–æ
  max_concurrent_models: 3  # –ú–∞–∫—Å–∏–º—É–º 3 –º–æ–¥–µ–ª—ñ
```

### 3. Swapper Service —Ç–∞ vLLM - —Ü–µ —Ä—ñ–∑–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏?

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –¢–∞–∫, —Ü–µ —Ä—ñ–∑–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏:

| Swapper Service | vLLM |
|----------------|------|
| –ö–µ—Ä—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º/–≤–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –º–æ–¥–µ–ª–µ–π | –í–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π —ñ–Ω—Ñ–µ—Ä–µ–Ω—Å-–¥–≤–∏–∂–æ–∫ |
| Single-active mode (–æ–¥–Ω–∞ –º–æ–¥–µ–ª—å) | Continuous serving (–º–æ–¥–µ–ª—ñ –∑–∞–≤–∂–¥–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ) |
| –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–∞–º'—è—Ç—ñ | –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è throughput |
| –ü—Ä–∞—Ü—é—î –∑ Ollama | –ü—Ä—è–º–∞ —Ä–æ–±–æ—Ç–∞ –∑ GPU |
| –õ–µ–≥–∫–∏–π, –ø—Ä–æ—Å—Ç–∏–π API | –°–∫–ª–∞–¥–Ω–∏–π, production-grade |

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Swapper:**
- –û–±–º–µ–∂–µ–Ω–∞ –ø–∞–º'—è—Ç—å (Node #2 MacBook)
- –ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—Ç–∏—Å—è –º—ñ–∂ –º–æ–¥–µ–ª—è–º–∏
- –†–µ—Å—É—Ä—Å–∏ –æ–±–º–µ–∂–µ–Ω—ñ

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ vLLM:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
- –ú–æ–¥–µ–ª—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–æ–≤–≥–æ
- –Ñ –≤–∏–¥—ñ–ª–µ–Ω—ñ GPU —Ä–µ—Å—É—Ä—Å–∏
- Production serving

---

## üé® –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –∫–∞–±—ñ–Ω–µ—Ç–∏

### API Endpoints –¥–ª—è –∫–∞–±—ñ–Ω–µ—Ç—ñ–≤

1. **GET /api/cabinet/swapper/status**
   - –ü–æ–≤–Ω–∏–π —Å—Ç–∞—Ç—É—Å Swapper Service
   - –ê–∫—Ç–∏–≤–Ω–∞ –º–æ–¥–µ–ª—å
   - –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –º–æ–¥–µ–ª–µ–π –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏

2. **GET /api/cabinet/swapper/models**
   - –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—Å—ñ –º–æ–¥–µ–ª—ñ
   - –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏/–≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏

3. **GET /api/cabinet/swapper/metrics/summary**
   - –ü—ñ–¥—Å—É–º–∫–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏
   - –ù–∞–π–±—ñ–ª—å—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å
   - –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–∞–±—ñ–Ω–µ—Ç—ñ

```typescript
// Fetch Swapper status
const response = await fetch('http://localhost:8890/api/cabinet/swapper/status');
const data = await response.json();

// Display active model
console.log('Active Model:', data.active_model.name);
console.log('Uptime:', data.active_model.uptime_hours, 'hours');

// Display all models
data.models.forEach(model => {
  console.log(`${model.name}: ${model.status} (${model.uptime_hours}h)`);
});
```

–î–µ—Ç–∞–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –¥–∏–≤. –≤ `docs/SWAPPER-CABINET-INTEGRATION.md`

---

## üìã –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

### –î–ª—è Node #2 (MacBook)

1. ‚úÖ Swapper Service —Å—Ç–≤–æ—Ä–µ–Ω–æ
2. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å: `docker-compose up -d swapper-service`
3. ‚è≥ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É: `curl http://localhost:8890/health`
4. ‚è≥ –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ –∫–∞–±—ñ–Ω–µ—Ç Node #2

### –î–ª—è Node #1 (Production Server)

1. ‚è≥ –î–æ–¥–∞—Ç–∏ Swapper Service –≤ docker-compose.yml –Ω–∞ Node #1
2. ‚è≥ –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –¥–ª—è Node #1
3. ‚è≥ –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –≤ –∫–∞–±—ñ–Ω–µ—Ç Node #1

### –î–ª—è –∫–∞–±—ñ–Ω–µ—Ç—ñ–≤

1. ‚è≥ –î–æ–¥–∞—Ç–∏ Swapper —Å–µ–∫—Ü—ñ—é –≤ –∞–¥–º—ñ–Ω-–∫–æ–Ω—Å–æ–ª—å
2. ‚è≥ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è:
   - –ê–∫—Ç–∏–≤–Ω–∞ –º–æ–¥–µ–ª—å
   - –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏
   - –ö–Ω–æ–ø–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è/–≤–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
   - –ì—Ä–∞—Ñ—ñ–∫–∏ uptime
3. ‚è≥ –î–æ–¥–∞—Ç–∏ real-time –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (polling –∞–±–æ WebSocket)

---

## üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### Environment Variables

```bash
OLLAMA_BASE_URL=http://172.17.0.1:11434  # –î–ª—è Docker
SWAPPER_CONFIG_PATH=/app/config/swapper_config.yaml
SWAPPER_MODE=single-active
MAX_CONCURRENT_MODELS=1
MODEL_SWAP_TIMEOUT=30
```

### Config File

–§–∞–π–ª: `services/swapper-service/config/swapper_config.yaml`

```yaml
swapper:
  mode: single-active
  max_concurrent_models: 1
  model_swap_timeout: 30
  gpu_enabled: true
  metal_acceleration: true

models:
  deepseek-r1-70b:
    path: ollama:deepseek-r1:70b
    type: llm
    size_gb: 42
    priority: high
  # ... —ñ–Ω—à—ñ –º–æ–¥–µ–ª—ñ
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –≤ –∫–∞–±—ñ–Ω–µ—Ç–∞—Ö

### –©–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è:

1. **–ê–∫—Ç–∏–≤–Ω–∞ –º–æ–¥–µ–ª—å:**
   - –ù–∞–∑–≤–∞ –º–æ–¥–µ–ª—ñ
   - –ß–∞—Å —Ä–æ–±–æ—Ç–∏ (uptime –≤ –≥–æ–¥–∏–Ω–∞—Ö)
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤
   - –ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

2. **–°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π:**
   - –í—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –º–æ–¥–µ–ª—ñ
   - –°—Ç–∞—Ç—É—Å –∫–æ–∂–Ω–æ—ó (loaded/unloaded)
   - Uptime –∫–æ–∂–Ω–æ—ó –º–æ–¥–µ–ª—ñ
   - –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏/–≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏

3. **–ü—ñ–¥—Å—É–º–∫–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏:**
   - –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º–æ–¥–µ–ª–µ–π
   - –ó–∞–≥–∞–ª—å–Ω–∏–π uptime
   - –ù–∞–π–±—ñ–ª—å—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å
   - –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤

---

## üêõ Troubleshooting

### Swapper Service –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏
docker logs swapper-service

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ Ollama –¥–æ—Å—Ç—É–ø–Ω–∏–π
curl http://localhost:11434/api/tags

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
cat services/swapper-service/config/swapper_config.yaml
```

### –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –º–æ–¥–µ–ª—å —î –≤ Ollama
curl http://localhost:11434/api/tags | grep "model_name"

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å Swapper
curl http://localhost:8890/status

# –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Ä—É—á–Ω—É
curl -X POST http://localhost:8890/models/model_name/load
```

### API –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Å–µ—Ä–≤—ñ—Å –∑–∞–ø—É—â–µ–Ω–∏–π
docker ps | grep swapper

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ health
curl http://localhost:8890/health

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ä—Ç
lsof -i :8890
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- **README.md** - –ü–æ–≤–Ω–∏–π –æ–ø–∏—Å API —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
- **SWAPPER-CABINET-INTEGRATION.md** - –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –∫–∞–±—ñ–Ω–µ—Ç–∏
- **INFRASTRUCTURE.md** - –û–Ω–æ–≤–ª–µ–Ω–æ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ Swapper Service

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ

- [x] Swapper Service –∫–æ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [x] Dockerfile —Ç–∞ requirements.txt
- [x] –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª
- [x] –î–æ–¥–∞–Ω–æ –≤ docker-compose.yml
- [x] Cabinet API endpoints
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- [ ] –ó–∞–ø—É—Å–∫ –Ω–∞ Node #2 (–ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏)
- [ ] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –∫–∞–±—ñ–Ω–µ—Ç Node #2 (–ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏)
- [ ] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –∫–∞–±—ñ–Ω–µ—Ç Node #1 (–ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏)

---

**Last Updated:** 2025-11-22  
**Maintained by:** Ivan Tytar & DAARION Team  
**Status:** ‚úÖ Service Ready ‚Äî Awaiting Deployment

