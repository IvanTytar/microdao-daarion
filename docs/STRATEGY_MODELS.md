# üéØ –°—Ç—Ä–∞—Ç–µ–≥—ñ—è –≤–∏–±–æ—Ä—É –º–æ–¥–µ–ª–µ–π: API vs –õ–æ–∫–∞–ª—å–Ω—ñ

**–î–∞—Ç–∞**: 2025-11-18  
**–ü–∏—Ç–∞–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Dify/API —á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤–∞–∂–∫—ñ –º–æ–¥–µ–ª—ñ?

---

## üìä –ü–æ—Ç–æ—á–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è

### –©–æ –≤–∂–µ —î –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:

#### 1. **–õ–æ–∫–∞–ª—å–Ω—ñ –º–æ–¥–µ–ª—ñ (Ollama)** ‚úÖ
- **qwen3:8b** - –≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ (5.2 GB)
- **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: DAGI Router –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –¥–ª—è DAARWIZZ, Helion, GREENFOOD
- **–ü–µ—Ä–µ–≤–∞–≥–∏**: 
  - ‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ
  - ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ (–¥–∞–Ω—ñ –Ω–µ –π–¥—É—Ç—å –≤ OpenAI)
  - ‚úÖ –ü—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω
- **–ù–µ–¥–æ–ª—ñ–∫–∏**:
  - ‚ö†Ô∏è –û–±–º–µ–∂–µ–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ (–Ω–µ–º–∞—î Vision, —Å–ª–∞–±—à–∏–π RAG)
  - ‚ö†Ô∏è –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ –Ω—ñ–∂ API
  - ‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î GPU –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ

#### 2. **Dify Platform** ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –ü—Ä–∞—Ü—é—î, –∞–ª–µ –ø–æ—Ç—Ä–µ–±—É—î API –∫–ª—é—á—ñ
- **OPENAI_API_BASE**: https://api.openai.com/v1
- **API Key**: –ü–æ—Ç—Ä—ñ–±–µ–Ω (–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ env)
- **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –ú–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ GPT-4V, Claude Vision —á–µ—Ä–µ–∑ API

#### 3. **Vision Encoder** ‚úÖ
- **–°—Ç–∞—Ç—É—Å**: –ü—Ä–∞—Ü—é—î (embeddings)
- **–û–±–º–µ–∂–µ–Ω–Ω—è**: –¢—ñ–ª—å–∫–∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è, –Ω–µ –æ–ø–∏—Å –∑–æ–±—Ä–∞–∂–µ–Ω—å

---

## ü§î –í–∞—Ä—ñ–∞–Ω—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó

### **–í–∞—Ä—ñ–∞–Ω—Ç A: API –º–æ–¥–µ–ª—ñ (OpenAI/Anthropic)** üí∞

**–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ**:
- OpenAI API key (–¥–ª—è GPT-4V)
- –ê–ë–û Anthropic API key (–¥–ª—è Claude Vision)

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ **GPT-4V** - –Ω–∞–π–∫—Ä–∞—â–∏–π Vision AI
- ‚úÖ **Claude 3 Vision** - —Ç–µ–∂ –¥—É–∂–µ —Ö–æ—Ä–æ—à–∏–π
- ‚úÖ –®–≤–∏–¥–∫–æ (API)
- ‚úÖ –ù–µ –ø–æ—Ç—Ä–µ–±—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

**–ù–µ–¥–æ–ª—ñ–∫–∏**:
- ‚ùå **–ö–æ—à—Ç—É—î –≥—Ä–æ—à–µ–π** ($0.01-0.03 –∑–∞ image)
- ‚ùå –î–∞–Ω—ñ –π–¥—É—Ç—å –≤ OpenAI/Anthropic
- ‚ùå –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É

**–í–∞—Ä—Ç—ñ—Å—Ç—å** (–ø—Ä–∏–±–ª–∏–∑–Ω–æ):
- GPT-4V: ~$0.01-0.03 –∑–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- Claude Vision: ~$0.01-0.015 –∑–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- –ü—Ä–∏ 100 —Ñ–æ—Ç–æ/–¥–µ–Ω—å = $1-3/–¥–µ–Ω—å = $30-90/–º—ñ—Å—è—Ü—å

---

### **–í–∞—Ä—ñ–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω—ñ Vision –º–æ–¥–µ–ª—ñ** üñ•Ô∏è

**–©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏**:
- **LLaVA** (Large Language and Vision Assistant) - ~7-13 GB
- –ê–ë–û **BLIP-2** - ~1-2 GB
- –ê–ë–û **InstructBLIP** - ~1-2 GB

**–ü–µ—Ä–µ–≤–∞–≥–∏**:
- ‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ
- ‚úÖ –ü—Ä–∞—Ü—é—î –æ—Ñ–ª–∞–π–Ω

**–ù–µ–¥–æ–ª—ñ–∫–∏**:
- ‚ùå **–ü–æ—Ç—Ä–µ–±—É—î GPU** –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ (CPU –¥—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–æ)
- ‚ùå –í–µ–ª–∏–∫—ñ —Ñ–∞–π–ª–∏ (7-13 GB)
- ‚ùå –ì—ñ—Ä—à–∞ —è–∫—ñ—Å—Ç—å –Ω—ñ–∂ GPT-4V
- ‚ùå –ü–æ—Ç—Ä–µ–±—É—î –±–∞–≥–∞—Ç–æ RAM (16GB+)

**–ß–∞—Å –æ–±—Ä–æ–±–∫–∏** (–Ω–∞ CPU):
- LLaVA: ~30-60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- BLIP-2: ~10-20 —Å–µ–∫—É–Ω–¥

**–ß–∞—Å –æ–±—Ä–æ–±–∫–∏** (–Ω–∞ GPU):
- LLaVA: ~2-5 —Å–µ–∫—É–Ω–¥
- BLIP-2: ~1-2 —Å–µ–∫—É–Ω–¥–∏

---

### **–í–∞—Ä—ñ–∞–Ω—Ç C: –ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥** üéØ (–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û)

**–©–æ —Ä–æ–±–∏—Ç–∏**:
1. **–î–ª—è –±–∞–∑–æ–≤–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤** (DAARWIZZ, Helion, GREENFOOD):
   - ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–ª–æ–∫–∞–ª—å–Ω–∏–π qwen3:8b** (–≤–∂–µ —î)
   - ‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ, –ø—Ä–∏–≤–∞—Ç–Ω–æ

2. **–î–ª—è Vision** (–æ–ø–∏—Å –∑–æ–±—Ä–∞–∂–µ–Ω—å):
   - **–í–∞—Ä—ñ–∞–Ω—Ç C1**: API (—è–∫—â–æ —î –±—é–¥–∂–µ—Ç)
     - GPT-4V —á–µ—Ä–µ–∑ OpenAI API
     - –ê–ë–û Claude Vision —á–µ—Ä–µ–∑ Anthropic API
   - **–í–∞—Ä—ñ–∞–Ω—Ç C2**: –õ–æ–∫–∞–ª—å–Ω–∏–π (—è–∫—â–æ –Ω–µ–º–∞—î –±—é–¥–∂–µ—Ç—É)
     - LLaVA —á–µ—Ä–µ–∑ Ollama (—è–∫—â–æ —î GPU)
     - –ê–ë–û BLIP-2 (–ª–µ–≥—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)

3. **–î–ª—è RAG**:
   - ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **Qdrant** (–≤–∂–µ –ø—Ä–∞—Ü—é—î)
   - ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **Weaviate** (–≤–∂–µ –ø—Ä–∞—Ü—é—î, —á–∞—Å—Ç–∏–Ω–∞ Dify)
   - ‚ùå –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Dify RAG (–ø–æ—Ç—Ä–µ–±—É—î API)

4. **–î–ª—è Web Search**:
   - ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **CrewAI** (–≤–∂–µ –ø—Ä–∞—Ü—é—î)
   - ‚úÖ CrewAI –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –º–æ–¥–µ–ª—ñ

---

## üí° –ú–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è

### **–ù–ï —Ä–∞–¥–∂—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤–∞–∂–∫—ñ Vision –º–æ–¥–µ–ª—ñ –Ø–ö–©–û:**
- ‚ùå –ù–µ–º–∞—î GPU (CPU –±—É–¥–µ –¥—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–æ)
- ‚ùå –ù–µ–º–∞—î –±–∞–≥–∞—Ç–æ RAM (16GB+)
- ‚ùå –ù–µ–º–∞—î –º—ñ—Å—Ü—è –Ω–∞ –¥–∏—Å–∫—É (7-13 GB)

### **–†–∞–¥–∂—É –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –õ–û–ö–ê–õ–¨–ù–Ü Vision –º–æ–¥–µ–ª—ñ –Ø–ö–©–û:**
- ‚úÖ –Ñ GPU (NVIDIA –∑ 8GB+ VRAM)
- ‚úÖ –Ñ –±–∞–≥–∞—Ç–æ RAM (32GB+)
- ‚úÖ –ù–µ–º–∞—î –±—é–¥–∂–µ—Ç—É –Ω–∞ API
- ‚úÖ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ñ—Å—Ç—å

### **–†–∞–¥–∂—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ API –Ø–ö–©–û:**
- ‚úÖ –Ñ –±—é–¥–∂–µ—Ç ($30-90/–º—ñ—Å—è—Ü—å)
- ‚úÖ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–∞–π–∫—Ä–∞—â–∞ —è–∫—ñ—Å—Ç—å
- ‚úÖ –ù–µ–º–∞—î GPU
- ‚úÖ –ü–æ—Ç—Ä—ñ–±–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å

---

## üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –ø–ª–∞–Ω –¥–ª—è —Ç–µ–±–µ

### **–°—Ü–µ–Ω–∞—Ä—ñ–π 1: –Ñ GPU + –Ω–µ–º–∞—î –±—é–¥–∂–µ—Ç—É** üñ•Ô∏è
```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ LLaVA —á–µ—Ä–µ–∑ Ollama
ollama pull llava:7b  # ~7 GB
# –ê–ë–û –ª–µ–≥—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
ollama pull llava:13b  # ~13 GB, –∫—Ä–∞—â–∞ —è–∫—ñ—Å—Ç—å
```

**–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è**:
```python
# router_handler.py
async def _analyze_photo_local(self, image_url: str):
    """–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π LLaVA"""
    response = await httpx.post(
        "http://localhost:11434/api/generate",
        json={
            "model": "llava:7b",
            "prompt": f"–û–ø–∏—à–∏ –¥–µ—Ç–∞–ª—å–Ω–æ —â–æ –Ω–∞ —Ü—å–æ–º—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ: {image_url}",
            "images": [image_url]
        }
    )
    return response.json()["response"]
```

---

### **–°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ù–µ–º–∞—î GPU + —î –±—é–¥–∂–µ—Ç** üí∞
```python
# router_handler.py
async def _analyze_photo_api(self, image_url: str):
    """–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ GPT-4V —á–µ—Ä–µ–∑ API"""
    import openai
    openai.api_key = os.getenv("OPENAI_API_KEY")
    
    response = openai.ChatCompletion.create(
        model="gpt-4-vision-preview",
        messages=[{
            "role": "user",
            "content": [
                {"type": "text", "text": "–û–ø–∏—à–∏ –¥–µ—Ç–∞–ª—å–Ω–æ —â–æ –Ω–∞ —Ü—å–æ–º—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ"},
                {"type": "image_url", "image_url": {"url": image_url}}
            ]
        }]
    )
    return response.choices[0].message.content
```

---

### **–°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ù–µ–º–∞—î GPU + –Ω–µ–º–∞—î –±—é–¥–∂–µ—Ç—É** ‚ö†Ô∏è
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: 
- ‚ö†Ô∏è **–ù–ï –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤–∞–∂–∫—ñ Vision –º–æ–¥–µ–ª—ñ** (–±—É–¥–µ –¥—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–æ)
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **BLIP-2** (–ª–µ–≥—à–∏–π, ~1-2 GB)
- –ê–ë–û –∑–∞–ª–∏—à–∏—Ç–∏ –∑–∞–≥–ª—É—à–∫—É –ø–æ–∫–∏ –Ω–µ –∑'—è–≤–∏—Ç—å—Å—è GPU/–±—é–¥–∂–µ—Ç

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è

| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –õ–æ–∫–∞–ª—å–Ω–∏–π (LLaVA) | API (GPT-4V) |
|----------|-------------------|--------------|
| **–í–∞—Ä—Ç—ñ—Å—Ç—å** | –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ | $0.01-0.03/–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è |
| **–®–≤–∏–¥–∫—ñ—Å—Ç—å (CPU)** | 30-60 —Å–µ–∫ | 2-5 —Å–µ–∫ |
| **–®–≤–∏–¥–∫—ñ—Å—Ç—å (GPU)** | 2-5 —Å–µ–∫ | 2-5 —Å–µ–∫ |
| **–Ø–∫—ñ—Å—Ç—å** | 7/10 | 10/10 |
| **–ü—Ä–∏–≤–∞—Ç–Ω—ñ—Å—Ç—å** | ‚úÖ –ü–æ–≤–Ω–∞ | ‚ùå –î–∞–Ω—ñ –≤ OpenAI |
| **–†–æ–∑–º—ñ—Ä** | 7-13 GB | 0 GB |
| **GPU –ø–æ—Ç—Ä—ñ–±–µ–Ω** | ‚úÖ –¢–∞–∫ | ‚ùå –ù—ñ |

---

## üöÄ –©–æ —Ä–æ–±–∏—Ç–∏ –∑–∞—Ä–∞–∑?

### **–ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î GPU**
```bash
ssh root@144.76.224.179 "nvidia-smi"
# –ê–ë–û
ssh root@144.76.224.179 "lspci | grep -i nvidia"
```

### **–ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î OpenAI API key**
```bash
ssh root@144.76.224.179 "docker exec docker-api-1 env | grep OPENAI_API_KEY"
```

### **–ö—Ä–æ–∫ 3: –í–∏—Ä—ñ—à–∏—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é**
- **–Ø–∫—â–æ —î GPU** ‚Üí –õ–æ–∫–∞–ª—å–Ω–∏–π LLaVA
- **–Ø–∫—â–æ —î API key** ‚Üí GPT-4V —á–µ—Ä–µ–∑ API
- **–Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ** ‚Üí –ó–∞–≥–ª—É—à–∫–∞ –ø–æ–∫–∏

---

## üí¨ –ú–æ—è –¥—É–º–∫–∞

**–Ø –ù–ï —Ä–∞–¥–∂—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤–∞–∂–∫—ñ –º–æ–¥–µ–ª—ñ –ë–ï–ó GPU** - –±—É–¥–µ –¥—É–∂–µ –ø–æ–≤—ñ–ª—å–Ω–æ —ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±—É–¥—É—Ç—å –Ω–µ–≤–¥–æ–≤–æ–ª–µ–Ω—ñ.

**–Ø–∫—â–æ —î GPU** - —Ç–æ–¥—ñ —Ç–∞–∫, –ª–æ–∫–∞–ª—å–Ω–∏–π LLaVA - —á—É–¥–æ–≤–∏–π –≤–∏–±—ñ—Ä!

**–Ø–∫—â–æ –Ω–µ–º–∞—î GPU** - –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ API (—è–∫—â–æ —î –±—é–¥–∂–µ—Ç) –∞–±–æ –∑–∞–ª–∏—à–∏—Ç–∏ –∑–∞–≥–ª—É—à–∫—É.

**–©–æ —Ç–∏ –¥—É–º–∞—î—à?** –Ñ GPU? –Ñ –±—é–¥–∂–µ—Ç –Ω–∞ API? üéØ

---

*–°—Ç–≤–æ—Ä–µ–Ω–æ: 2025-11-18*

