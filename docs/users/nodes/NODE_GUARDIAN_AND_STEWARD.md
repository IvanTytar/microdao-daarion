# Node Guardian & Node Steward

**–î–∞—Ç–∞:** 29 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–æ (Task 038)

–£ –µ–∫–æ—Å–∏—Å—Ç–µ–º—ñ DAARION –∫–æ–∂–Ω–∞ –Ω–æ–¥–∞ –º–∞—î –¥–≤–∞ –∫–ª—é—á–æ–≤—ñ "–æ–±–ª–∏—á—á—è" ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –∑–∞ —ó—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —É –º–µ—Ä–µ–∂—ñ.

---

## 1. –†–æ–ª—ñ

### üõ°Ô∏è Node Guardian (–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –Ω–∞–≥–ª—è–¥–∞—á)
**–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:**
* –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (CPU, RAM, Disk, GPU).
* –°—Ç–∞–Ω —Å–µ—Ä–≤—ñ—Å—ñ–≤ (Docker, Systemd).
* –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–ª–µ—Ä—Ç–∏.
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–µ–∞–∫—Ü—ñ—è –Ω–∞ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏ (–≤ –º–µ–∂–∞—Ö –¥–æ–∑–≤–æ–ª–µ–Ω–æ–≥–æ).

**–¢–∏–ø –∞–≥–µ–Ω—Ç–∞:** `node_guardian` (–∞–±–æ `infra_monitor`).

### üó£Ô∏è Node Steward (–•–∞–∑—è—ó–Ω –Ω–æ–¥–∏)
**–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:**
* –ü—É–±–ª—ñ—á–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –Ω–æ–¥–∏ —è–∫ "–≥—Ä–æ–º–∞–¥—è–Ω–∏–Ω–∞".
* –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –∑ —ñ–Ω—à–∏–º–∏ —É—á–∞—Å–Ω–∏–∫–∞–º–∏ –º–µ—Ä–µ–∂—ñ.
* –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é —Ç–∞ –ø—Ä–∞–≤–∏–ª–∞–º–∏ (Governance).
* "Human Interface" –¥–æ –Ω–æ–¥–∏.

**–¢–∏–ø –∞–≥–µ–Ω—Ç–∞:** `node_steward` (–∞–±–æ `infra_ops`).

---

## 2. –Ø–∫ –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏

–ê–≥–µ–Ω—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–æ—é (`city-service`) –∑–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º:

1. **–ü–æ—à—É–∫ –∑–∞ —Ç–∏–ø–æ–º (`kind`):**
   * –°–∏—Å—Ç–µ–º–∞ —à—É–∫–∞—î –∞–≥–µ–Ω—Ç—ñ–≤, –ø—Ä–∏–≤'—è–∑–∞–Ω–∏—Ö –¥–æ —Ü—ñ—î—ó –Ω–æ–¥–∏ (`node_id`), —è–∫—ñ –º–∞—é—Ç—å `kind = 'node_guardian'` –∞–±–æ `'node_steward'`.
   
2. **Fallback (—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å):**
   * –Ø–∫—â–æ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —Å–∏—Å—Ç–µ–º–∞ —à—É–∫–∞—î `infra_monitor` (—è–∫ Guardian) —Ç–∞ `infra_ops` (—è–∫ Steward).

3. **Node Cache (Legacy):**
   * –Ø–∫—â–æ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ—à—É–∫ –Ω–µ –¥–∞–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–∞–∫–µ—à–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ —Ç–∞–±–ª–∏—Ü—ñ `node_registry.nodes` (—è–∫—â–æ –≤–æ–Ω–æ –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤—Ä—É—á–Ω—É).

### SQL –¥–ª—è –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è (–ø—Ä–∏–∫–ª–∞–¥)

```sql
-- –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ Guardian
UPDATE agents 
SET kind = 'node_guardian' 
WHERE id = 'my-monitor-agent-id';

-- –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ Steward
UPDATE agents 
SET kind = 'node_steward' 
WHERE id = 'my-steward-agent-id';
```

---

## 3. –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ UI

### Node Dashboard (`/nodes/[nodeId]`)
–£ –∫–∞–±—ñ–Ω–µ—Ç—ñ –Ω–æ–¥–∏ (—è–∫ –ø–æ–≤–Ω–æ–º—É, —Ç–∞–∫ —ñ –±–∞–∑–æ–≤–æ–º—É –ø—Ä–æ—Ñ—ñ–ª—ñ) –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∫–∞—Ä—Ç–∫–∞ **"Node Guardian & Steward"**:
* –ü–æ–∫–∞–∑—É—î —ñ–º–µ–Ω–∞ —Ç–∞ —Ä–æ–ª—ñ –∞–≥–µ–Ω—Ç—ñ–≤.
* –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ó—Ö **–ü—É–±–ª—ñ—á–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å** (`/citizens/[slug]`).
* –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ **–ö–∞–±—ñ–Ω–µ—Ç –∞–≥–µ–Ω—Ç–∞** (`/agents/[id]`).

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –æ–ø–µ—Ä–∞—Ç–æ—Ä—É —à–≤–∏–¥–∫–æ –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∞–≥–µ–Ω—Ç–∞ –∞–±–æ –ø–æ—á–∞—Ç–∏ –¥—ñ–∞–ª–æ–≥ –∑ –Ω–∏–º.

