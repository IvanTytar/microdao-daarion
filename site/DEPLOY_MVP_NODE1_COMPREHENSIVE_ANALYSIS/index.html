
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://IvanTytar.github.io/microdao-daarion/DEPLOY_MVP_NODE1_COMPREHENSIVE_ANALYSIS/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>üöÄ MVP Deployment –Ω–∞ –ù–û–î–ê1 ‚Äî –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ê–Ω–∞–ª—ñ–∑ - DAARION Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mvp-deployment-1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DAARION Documentation" class="md-header__button md-logo" aria-label="DAARION Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DAARION Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              üöÄ MVP Deployment –Ω–∞ –ù–û–î–ê1 ‚Äî –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ê–Ω–∞–ª—ñ–∑
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DAARION Documentation" class="md-nav__button md-logo" aria-label="DAARION Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DAARION Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../public/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../public/getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../public/architecture-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../public/daiS_daos_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAIS & DAOS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Internal
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Internal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Infra
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Infra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal/infra/INFRA_AUTOMATION_PACK_V1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infra Automation Pack v1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal/infra/monitoring_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal/infra/nodes_registry_v0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nodes Registry v0
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Specs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Specs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal/specs/matrix_presence_aggregator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matrix Presence Aggregator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal/specs/city_map_spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    City Map Spec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal/specs/node_join_protocol_draft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node Join Protocol (Draft)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      üìä Executive Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìä Executive Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      ‚úÖ –©–æ –≥–æ—Ç–æ–≤–æ:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ —Ä–∏–∑–∏–∫–∏:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      üó∫Ô∏è –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞ –ö–∞—Ä—Ç–∏–Ω–∞
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üó∫Ô∏è –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞ –ö–∞—Ä—Ç–∏–Ω–∞">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-production" class="md-nav__link">
    <span class="md-ellipsis">
      –ù–û–î–ê1 (Production)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-development" class="md-nav__link">
    <span class="md-ellipsis">
      –ù–û–î–ê2 (Development)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1-3-mvp-1" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1-3 MVP (—Ç—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏ –¥–æ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      üîç –ê–Ω–∞–ª—ñ–∑ –ö–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üîç –ê–Ω–∞–ª—ñ–∑ –ö–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      ‚úÖ –ü–æ—Ä—Ç–∏ (–ù–µ–º–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤!)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      ‚ö†Ô∏è –ë–∞–∑–∞ –î–∞–Ω–∏—Ö (–ö—Ä–∏—Ç–∏—á–Ω–æ!)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx-config" class="md-nav__link">
    <span class="md-ellipsis">
      ‚ö†Ô∏è Nginx Config (–ü–æ—Ç—Ä–µ–±—É—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-strategy-staged-rollout" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Deployment Strategy: STAGED ROLLOUT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üéØ Deployment Strategy: STAGED ROLLOUT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-pre-flight-2" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 0: PRE-FLIGHT (–ù–∞ –ù–û–î–ê2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-backup-analysis-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 1: BACKUP &amp; ANALYSIS (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-code-sync-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 2: CODE SYNC (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-environment-config-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 3: ENVIRONMENT CONFIG (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-database-migrations-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 4: DATABASE MIGRATIONS (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-docker-build-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 5: DOCKER BUILD (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-service-startup-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 6: SERVICE STARTUP (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-nginx-update-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 7: NGINX UPDATE (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-smoke-tests-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 8: SMOKE TESTS (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-monitoring-1" class="md-nav__link">
    <span class="md-ellipsis">
      –§–∞–∑–∞ 9: MONITORING (–ù–∞ –ù–û–î–ê1)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rollback-plan" class="md-nav__link">
    <span class="md-ellipsis">
      üö® Rollback Plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üö® Rollback Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6-service-startup-failed" class="md-nav__link">
    <span class="md-ellipsis">
      –Ø–∫—â–æ –§–∞–∑–∞ 6 (Service Startup) failed:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-nginx-update-failed" class="md-nav__link">
    <span class="md-ellipsis">
      –Ø–∫—â–æ –§–∞–∑–∞ 7 (Nginx Update) failed:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      üìã Final Checklist
    </span>
  </a>
  
    <nav class="md-nav" aria-label="üìã Final Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-Deployment:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Deployment:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      üéØ Success Criteria
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      üîÆ Next Steps (–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ deployment)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emergency-contacts" class="md-nav__link">
    <span class="md-ellipsis">
      üìû Emergency Contacts
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="mvp-deployment-1">üöÄ MVP Deployment –Ω–∞ –ù–û–î–ê1 ‚Äî –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ê–Ω–∞–ª—ñ–∑<a class="headerlink" href="#mvp-deployment-1" title="Permanent link">&para;</a></h1>
<p><strong>–í–µ—Ä—Å—ñ—è:</strong> 1.0.0<br />
<strong>–î–∞—Ç–∞:</strong> 25 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025<br />
<strong>–°—Ç–∞—Ç—É—Å:</strong> Ready for Execution<br />
<strong>–ù–û–î–ê1 IP:</strong> 144.76.224.179<br />
<strong>Domain:</strong> gateway.daarion.city</p>
<hr />
<h2 id="executive-summary">üìä Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">&para;</a></h2>
<p>–ü—ñ—Å–ª—è –∞–Ω–∞–ª—ñ–∑—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –º–∞—î–º–æ:</p>
<h3 id="_1">‚úÖ –©–æ –≥–æ—Ç–æ–≤–æ:<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Phase 1-3 –∫–æ–¥ –≥–æ—Ç–æ–≤–∏–π</strong> (Frontend MVP, Agents Core, City MVP, Second Me)</li>
<li><strong>–ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î –≥–æ—Ç–æ–≤—ñ</strong> (001-010)</li>
<li><strong>Docker Compose –≥–æ—Ç–æ–≤–∏–π</strong> (<code>docker-compose.all.yml</code>)</li>
<li><strong>–°–µ—Ä–≤—ñ—Å–∏ –∑—ñ–±—Ä–∞–Ω—ñ</strong> (agents, city, secondme, microdao)</li>
<li><strong>Nginx/SSL –ø—Ä–∞—Ü—é—î</strong> –Ω–∞ –ù–û–î–ê1 (<code>gateway.daarion.city</code>)</li>
</ol>
<h3 id="_2">‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ —Ä–∏–∑–∏–∫–∏:<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤ –ø—Ä–æ—Ü–µ—Å—ñ</strong> (Router v1.1.0, Telegram Enhanced)</li>
<li><strong>–©–æ–¥–µ–Ω–Ω—ñ –∑–º—ñ–Ω–∏</strong> –Ω–∞ –æ–±–æ—Ö –Ω–æ–¥–∞—Ö</li>
<li><strong>–ù–µ–≤—ñ–¥–æ–º–∏–π —Å—Ç–∞–Ω production –ë–î</strong> –Ω–∞ –ù–û–î–ê1</li>
<li><strong>–ú–æ–∂–ª–∏–≤—ñ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –ø–æ—Ä—Ç—ñ–≤</strong> (—Ö–æ—á–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–∫–∞–∑—É—î —â–æ –Ω–µ–º–∞—î)</li>
</ol>
<h3 id="_3">üéØ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è:<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p><strong>Staged Deployment</strong> –∑ isolation + rollback plan</p>
<hr />
<h2 id="_4">üó∫Ô∏è –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞ –ö–∞—Ä—Ç–∏–Ω–∞<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="1-production">–ù–û–î–ê1 (Production)<a class="headerlink" href="#1-production" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="mf">144.76.224.179</span><span class="w"> </span><span class="p">(</span><span class="n">Hetzner</span><span class="w"> </span><span class="n">GEX44</span><span class="p">)</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">DAGI</span><span class="w"> </span><span class="n">Stack</span><span class="w"> </span><span class="p">(</span><span class="mf">17</span><span class="o">+</span><span class="w"> </span><span class="n">—Å–µ—Ä–≤—ñ—Å—ñ–≤</span><span class="p">)</span><span class="w"> </span><span class="err">‚úÖ</span><span class="w"> </span><span class="n">–ü–†–ê–¶–Æ–Ñ</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Router</span><span class="w"> </span><span class="p">(</span><span class="mf">9102</span><span class="p">)</span><span class="w"> </span><span class="err">‚Äî</span><span class="w"> </span><span class="n">–≤</span><span class="w"> </span><span class="n">–ø—Ä–æ—Ü–µ—Å—ñ</span><span class="w"> </span><span class="n">–æ–Ω–æ–≤–ª–µ–Ω–Ω—è</span><span class="w"> </span><span class="n">–¥–æ</span><span class="w"> </span><span class="n">v1</span><span class="mf">.1.0</span><span class="w"> </span><span class="n">multimodal</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Gateway</span><span class="w"> </span><span class="p">(</span><span class="mf">9300</span><span class="p">)</span><span class="w"> </span><span class="err">‚Äî</span><span class="w"> </span><span class="n">Telegram</span><span class="w"> </span><span class="n">Gateway</span><span class="w"> </span><span class="n">Enhanced</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">DevTools</span><span class="w"> </span><span class="p">(</span><span class="mf">8008</span><span class="p">)</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Swapper</span><span class="w"> </span><span class="p">(</span><span class="mf">8890</span><span class="o">-</span><span class="mf">8891</span><span class="p">)</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Frontend</span><span class="w"> </span><span class="p">(</span><span class="mf">8899</span><span class="p">)</span><span class="w"> </span><span class="err">‚Äî</span><span class="w"> </span><span class="n">—ñ—Å–Ω—É—é—á–∏–π</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nb">Pos</span><span class="n">tgreSQL</span><span class="w"> </span><span class="p">(</span><span class="mf">5432</span><span class="p">)</span><span class="w"> </span><span class="err">‚ö†Ô∏è</span><span class="w"> </span><span class="n">PRODUCTION</span><span class="w"> </span><span class="n">DB</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Redis</span><span class="w"> </span><span class="p">(</span><span class="mf">6379</span><span class="p">)</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Neo4j</span><span class="w"> </span><span class="p">(</span><span class="mf">7687</span><span class="p">,</span><span class="w"> </span><span class="mf">7474</span><span class="p">)</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Qdrant</span><span class="w"> </span><span class="p">(</span><span class="mf">6333</span><span class="p">,</span><span class="w"> </span><span class="mf">6334</span><span class="p">)</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Grafana</span><span class="w"> </span><span class="p">(</span><span class="mf">3000</span><span class="p">)</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Prometheus</span><span class="w"> </span><span class="p">(</span><span class="mf">9090</span><span class="p">)</span>
<span class="err">‚îÇ</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">Nginx</span><span class="w"> </span><span class="p">(</span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="mf">443</span><span class="p">)</span><span class="w"> </span><span class="err">‚úÖ</span><span class="w"> </span><span class="n">SSL</span><span class="w"> </span><span class="kd">Let</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">Encrypt</span>
<span class="err">‚îÇ</span><span class="w">   </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="n">gateway</span><span class="mf">.</span><span class="n">daarion</span><span class="mf">.</span><span class="n">city</span><span class="w"> </span><span class="err">‚Üí</span><span class="w"> </span><span class="n">–ø—Ä–∞—Ü—é—î</span>
<span class="err">‚îÇ</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">microdao</span><span class="o">-</span><span class="n">daarion</span><span class="w"> </span><span class="p">(</span><span class="n">project</span><span class="w"> </span><span class="n">root</span><span class="p">)</span>
</code></pre></div>

<h3 id="2-development">–ù–û–î–ê2 (Development)<a class="headerlink" href="#2-development" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="mf">192.168.1.244</span><span class="w"> </span><span class="p">(</span><span class="n">MacBook</span><span class="w"> </span><span class="n">Pro</span><span class="w"> </span><span class="n">M4</span><span class="w"> </span><span class="n">Max</span><span class="p">)</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">–†–æ–∑—Ä–æ–±–∫–∞</span><span class="w"> </span><span class="n">Phase</span><span class="w"> </span><span class="mf">1</span><span class="o">-</span><span class="mf">3</span><span class="w"> </span><span class="err">‚úÖ</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="n">–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ñ</span><span class="w"> </span><span class="n">—Å–µ—Ä–≤—ñ—Å–∏</span><span class="w"> </span><span class="p">(</span><span class="n">STT</span><span class="p">,</span><span class="w"> </span><span class="n">OCR</span><span class="p">,</span><span class="w"> </span><span class="n">Web</span><span class="w"> </span><span class="n">Search</span><span class="p">,</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="n">DB</span><span class="p">)</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">apple</span><span class="o">/</span><span class="n">github</span><span class="o">-</span><span class="n">projects</span><span class="o">/</span><span class="n">microdao</span><span class="o">-</span><span class="n">daarion</span>
</code></pre></div>

<h3 id="phase-1-3-mvp-1">Phase 1-3 MVP (—Ç—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏ –¥–æ –ù–û–î–ê1)<a class="headerlink" href="#phase-1-3-mvp-1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>–ù–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏:
‚îú‚îÄ‚îÄ agents-service (7002) ‚Äî Phase 2
‚îú‚îÄ‚îÄ city-service (7001) ‚Äî Phase 3
‚îú‚îÄ‚îÄ secondme-service (7003) ‚Äî Phase 3
‚îî‚îÄ‚îÄ microdao-service (7004) ‚Äî Phase 7

–ù–æ–≤—ñ API endpoints:
‚îú‚îÄ‚îÄ /api/agents/* ‚Üí 7002
‚îú‚îÄ‚îÄ /api/city/* ‚Üí 7001
‚îú‚îÄ‚îÄ /api/secondme/* ‚Üí 7003
‚îî‚îÄ‚îÄ /api/microdao/* ‚Üí 7004

WebSocket:
‚îî‚îÄ‚îÄ /ws/city/* ‚Üí 7001
</code></pre></div>

<hr />
<h2 id="_5">üîç –ê–Ω–∞–ª—ñ–∑ –ö–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<h3 id="_6">‚úÖ –ü–æ—Ä—Ç–∏ (–ù–µ–º–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤!)<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>–Ü—Å–Ω—É—é—á—ñ (–ù–û–î–ê1)</th>
<th>–ù–æ–≤—ñ (MVP)</th>
<th>–°—Ç–∞—Ç—É—Å</th>
</tr>
</thead>
<tbody>
<tr>
<td>9102 (Router)</td>
<td>7002 (Agents)</td>
<td>‚úÖ OK</td>
</tr>
<tr>
<td>9300 (Gateway)</td>
<td>7001 (City)</td>
<td>‚úÖ OK</td>
</tr>
<tr>
<td>8008 (DevTools)</td>
<td>7003 (Second Me)</td>
<td>‚úÖ OK</td>
</tr>
<tr>
<td>8890 (Swapper)</td>
<td>7004 (MicroDAO)</td>
<td>‚úÖ OK</td>
</tr>
<tr>
<td>8899 (Frontend)</td>
<td>-</td>
<td>‚ö†Ô∏è –ú–æ–∂–µ –ø–æ—Ç—Ä–µ–±—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</td>
</tr>
</tbody>
</table>
<h3 id="_7">‚ö†Ô∏è –ë–∞–∑–∞ –î–∞–Ω–∏—Ö (–ö—Ä–∏—Ç–∏—á–Ω–æ!)<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><strong>–°–∏—Ç—É–∞—Ü—ñ—è:</strong>
- –ù–û–î–ê1 –º–∞—î <strong>production PostgreSQL</strong> (<code>daarion_memory</code>)
- MVP –ø–æ—Ç—Ä–µ–±—É—î <strong>–Ω–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ</strong> (–º—ñ–≥—Ä–∞—Ü—ñ—ó 007-010)
- –ù–µ–≤—ñ–¥–æ–º–æ —á–∏ —ñ—Å–Ω—É—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ –Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—é—Ç—å</p>
<p><strong>–†—ñ—à–µ–Ω–Ω—è:</strong>
1. <strong>Backup –ø–µ—Ä–µ–¥ –º—ñ–≥—Ä–∞—Ü—ñ—î—é</strong> (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ!)
2. <strong>–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ</strong> –ø–µ—Ä–µ–¥ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è–º –º—ñ–≥—Ä–∞—Ü—ñ–π
3. <strong>Rollback –ø–ª–∞–Ω</strong> –≥–æ—Ç–æ–≤–∏–π</p>
<h3 id="nginx-config">‚ö†Ô∏è Nginx Config (–ü–æ—Ç—Ä–µ–±—É—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è)<a class="headerlink" href="#nginx-config" title="Permanent link">&para;</a></h3>
<p><strong>–Ü—Å–Ω—É—é—á–∏–π config:</strong></p>
<div class="codehilite"><pre><span></span><code>/etc/nginx/sites-available/daarion
‚îú‚îÄ‚îÄ /telegram/webhook ‚Üí 9300
‚îî‚îÄ‚îÄ /helion/telegram/webhook ‚Üí 9300
</code></pre></div>

<p><strong>–¢—Ä–µ–±–∞ –¥–æ–¥–∞—Ç–∏:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/api/agents/</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7002/</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api/city/</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7001/</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api/secondme/</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7003/</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">location</span><span class="w"> </span><span class="s">/api/microdao/</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7004/</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">location</span><span class="w"> </span><span class="s">/ws/city/</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7001/ws/city/</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Upgrade</span><span class="w"> </span><span class="nv">$http_upgrade</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Connection</span><span class="w"> </span><span class="s">&quot;upgrade&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="deployment-strategy-staged-rollout">üéØ Deployment Strategy: STAGED ROLLOUT<a class="headerlink" href="#deployment-strategy-staged-rollout" title="Permanent link">&para;</a></h2>
<h3 id="0-pre-flight-2">–§–∞–∑–∞ 0: PRE-FLIGHT (–ù–∞ –ù–û–î–ê2)<a class="headerlink" href="#0-pre-flight-2" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–¥—É</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/Users/apple/github-projects/microdao-daarion

<span class="c1"># 1. Commit –≤—Å—ñ –∑–º—ñ–Ω–∏</span>
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Phase 1-3: Ready for NODE1 deployment&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å—ñ —Ñ–∞–π–ª–∏ –Ω–∞ –º—ñ—Å—Ü—ñ</span>
ls<span class="w"> </span>-la<span class="w"> </span>services/<span class="o">{</span>agents,city,secondme,microdao<span class="o">}</span>-service/
ls<span class="w"> </span>-la<span class="w"> </span>migrations/00<span class="o">{</span><span class="m">7</span>,8,9,10<span class="o">}</span>_*.sql
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] Git push –≤–∏–∫–æ–Ω–∞–Ω–æ
- [ ] –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –º–∞—é—Ç—å Dockerfile
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—ó 007-010 —ñ—Å–Ω—É—é—Ç—å
- [ ] docker-compose.all.yml –æ–Ω–æ–≤–ª–µ–Ω–æ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)</p>
<hr />
<h3 id="1-backup-analysis-1">–§–∞–∑–∞ 1: BACKUP &amp; ANALYSIS (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#1-backup-analysis-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ó–∞—Ö–∏—Å—Ç–∏—Ç–∏ production —ñ –∑—ñ–±—Ä–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># SSH –Ω–∞ –ù–û–î–ê1</span>
ssh<span class="w"> </span>root@144.76.224.179
<span class="nb">cd</span><span class="w"> </span>/opt/microdao-daarion

<span class="c1"># 1. Backup PostgreSQL (–ö–†–ò–¢–ò–ß–ù–û!)</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>daarion-postgres<span class="w"> </span>pg_dump<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>daarion_memory<span class="w"> </span>&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/root/backups/daarion_memory_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>.sql

<span class="c1"># 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;\dt&quot;</span>

<span class="c1"># 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ —Å–µ—Ä–≤—ñ—Å–∏</span>
docker<span class="w"> </span>ps<span class="w"> </span>--format<span class="w"> </span><span class="s2">&quot;table {{.Names}}\t{{.Status}}\t{{.Ports}}&quot;</span>

<span class="c1"># 4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ä—Ç–∏</span>
sudo<span class="w"> </span>netstat<span class="w"> </span>-tulpn<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LISTEN<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;700[1-4]|9102|9300&quot;</span>

<span class="c1"># 5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Nginx config</span>
cat<span class="w"> </span>/etc/nginx/sites-available/daarion
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] Backup –ë–î —Å—Ç–≤–æ—Ä–µ–Ω–æ (–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É!)
- [ ] –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ
- [ ] –ü–æ—Ä—Ç–∏ 7001-7004 –≤—ñ–ª—å–Ω—ñ
- [ ] Nginx config –∑–±–µ—Ä–µ–∂–µ–Ω–æ</p>
<hr />
<h3 id="2-code-sync-1">–§–∞–∑–∞ 2: CODE SYNC (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#2-code-sync-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–¥ –∑ GitHub</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/microdao-daarion

<span class="c1"># 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω</span>
git<span class="w"> </span>status
git<span class="w"> </span>log<span class="w"> </span>--oneline<span class="w"> </span>-5

<span class="c1"># 2. Pull –Ω–æ–≤–∏—Ö –∑–º—ñ–Ω</span>
git<span class="w"> </span>fetch<span class="w"> </span>origin
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main

<span class="c1"># 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ñ–∞–π–ª–∏ –ø—Ä–∏–±—É–ª–∏</span>
ls<span class="w"> </span>-la<span class="w"> </span>services/<span class="o">{</span>agents,city,secondme,microdao<span class="o">}</span>-service/Dockerfile
ls<span class="w"> </span>-la<span class="w"> </span>migrations/007_*.sql<span class="w"> </span>migrations/008_*.sql<span class="w"> </span>migrations/009_*.sql<span class="w"> </span>migrations/010_*.sql
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] Git pull —É—Å–ø—ñ—à–Ω–∏–π
- [ ] –ù–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ –ø—Ä–∏—Å—É—Ç–Ω—ñ
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—ó 007-010 –Ω–∞ –º—ñ—Å—Ü—ñ</p>
<hr />
<h3 id="3-environment-config-1">–§–∞–∑–∞ 3: ENVIRONMENT CONFIG (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#3-environment-config-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/microdao-daarion

<span class="c1"># 1. Backup —ñ—Å–Ω—É—é—á–æ–≥–æ .env</span>
cp<span class="w"> </span>.env<span class="w"> </span>.env.backup.<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>

<span class="c1"># 2. –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>.env<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>

<span class="s"># ============================================================================</span>
<span class="s"># PHASE 1-3 MVP SERVICES</span>
<span class="s"># ============================================================================</span>

<span class="s"># Service URLs</span>
<span class="s">AGENTS_SERVICE_URL=http://agents-service:7002</span>
<span class="s">CITY_SERVICE_URL=http://city-service:7001</span>
<span class="s">SECONDME_SERVICE_URL=http://secondme-service:7003</span>
<span class="s">MICRODAO_SERVICE_URL=http://microdao-service:7004</span>

<span class="s"># City Configuration</span>
<span class="s">CITY_DEFAULT_ROOMS=general,welcome,builders,science,energy</span>
<span class="s">SECONDME_AGENT_ID=ag_secondme_global</span>

<span class="s"># WebSocket</span>
<span class="s">WS_BASE_URL=wss://gateway.daarion.city/ws</span>

<span class="s"># Frontend (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏)</span>
<span class="s">VITE_API_BASE_URL=https://gateway.daarion.city/api</span>
<span class="s">VITE_WS_BASE_URL=wss://gateway.daarion.city/ws</span>

<span class="s">EOF</span>

<span class="c1"># 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</span>
tail<span class="w"> </span>-20<span class="w"> </span>.env
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] .env backup —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [ ] –ù–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ –¥–æ–¥–∞–Ω–æ
- [ ] –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π</p>
<hr />
<h3 id="4-database-migrations-1">–§–∞–∑–∞ 4: DATABASE MIGRATIONS (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#4-database-migrations-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó 007-010</p>
<p>‚ö†Ô∏è <strong>–ö–†–ò–¢–ò–ß–ù–ê –§–ê–ó–ê ‚Äî –ú–û–ñ–õ–ò–í–Ü–°–¢–¨ ROLLBACK</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/microdao-daarion

<span class="c1"># –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —è–∫—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤–∂–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ (—è–∫—â–æ —î tracking)</span>
<span class="c1"># –∞–±–æ –≤—Ä—É—á–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—é—Ç—å —Ç–∞–±–ª–∏—Ü—ñ</span>

<span class="c1"># –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó (–ü–û –û–î–ù–Ü–ô!)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Applying 007_create_agents_tables.sql...&quot;</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>&lt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>migrations/007_create_agents_tables.sql

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Applying 008_create_microdao_core.sql...&quot;</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>&lt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>migrations/008_create_microdao_core.sql

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Applying 009_create_dao_core.sql...&quot;</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>&lt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>migrations/009_create_dao_core.sql

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Applying 010_create_city_backend.sql...&quot;</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>&lt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>migrations/010_create_city_backend.sql

<span class="c1"># –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ç–∞–±–ª–∏—Ü—ñ —Å—Ç–≤–æ—Ä–µ–Ω—ñ</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;\dt&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;agents|city|secondme|microdao&quot;</span>
</code></pre></div>

<p><strong>–Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ROLLBACK: –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑ backup</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>&lt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/root/backups/daarion_memory_YYYYMMDD_HHMMSS.sql
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—è 007 —É—Å–ø—ñ—à–Ω–∞
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—è 008 —É—Å–ø—ñ—à–Ω–∞
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—è 009 —É—Å–ø—ñ—à–Ω–∞
- [ ] –ú—ñ–≥—Ä–∞—Ü—ñ—è 010 —É—Å–ø—ñ—à–Ω–∞
- [ ] –ù–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ</p>
<hr />
<h3 id="5-docker-build-1">–§–∞–∑–∞ 5: DOCKER BUILD (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#5-docker-build-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ó—ñ–±—Ä–∞—Ç–∏ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/microdao-daarion

<span class="c1"># Build –Ω–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ (–æ–¥–∏–Ω –∑–∞ –æ–¥–Ω–∏–º –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>build<span class="w"> </span>agents-service
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>build<span class="w"> </span>city-service
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>build<span class="w"> </span>secondme-service
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>build<span class="w"> </span>microdao-service

<span class="c1"># –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –æ–±—Ä–∞–∑–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ</span>
docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;agents-service|city-service|secondme|microdao&quot;</span>
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] agents-service –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [ ] city-service –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [ ] secondme-service –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [ ] microdao-service –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ</p>
<hr />
<h3 id="6-service-startup-1">–§–∞–∑–∞ 6: SERVICE STARTUP (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#6-service-startup-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ (–ë–ï–ó –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —ñ—Å–Ω—É—é—á–∏—Ö!)</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/opt/microdao-daarion

<span class="c1"># –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¢–Ü–õ–¨–ö–ò –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>agents-service<span class="w"> </span>city-service<span class="w"> </span>secondme-service<span class="w"> </span>microdao-service

<span class="c1"># –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ —Å—Ç–∞—Ä—Ç (–ø–µ—Ä—à—ñ 30 —Å–µ–∫—É–Ω–¥ –∫—Ä–∏—Ç–∏—á–Ω—ñ)</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>agents-service<span class="w"> </span>city-service<span class="w"> </span>secondme-service<span class="w"> </span>microdao-service

<span class="c1"># –í –æ–∫—Ä–µ–º–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ health</span>
watch<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;docker ps | grep -E &#39;agents-service|city-service|secondme|microdao&#39;&quot;</span>
</code></pre></div>

<p><strong>–©–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏:</strong>
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—è (–Ω–µ –≤ Restarting —Å—Ç–∞–Ω—ñ)
- [ ] –õ–æ–≥–∏ –Ω–µ –º—ñ—Å—Ç—è—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
- [ ] –ë–î –∑'—î–¥–Ω–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω—ñ
- [ ] Health endpoints –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å</p>
<hr />
<h3 id="7-nginx-update-1">–§–∞–∑–∞ 7: NGINX UPDATE (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#7-nginx-update-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ endpoints –¥–æ Nginx</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Backup —ñ—Å–Ω—É—é—á–æ–≥–æ config</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/etc/nginx/sites-available/daarion<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/etc/nginx/sites-available/daarion.backup.<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>

<span class="c1"># –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ location blocks (–ü–ï–†–ï–î –æ—Å—Ç–∞–Ω–Ω—å–æ—é —Ñ—ñ–≥—É—Ä–Ω–æ—é –¥—É–∂–∫–æ—é —Å–µ—Ä–≤–µ—Ä–∞)</span>
sudo<span class="w"> </span>vim<span class="w"> </span>/etc/nginx/sites-available/daarion
</code></pre></div>

<p><strong>–î–æ–¥–∞—Ç–∏ —Ü–µ–π –±–ª–æ–∫:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="c1"># ========================================================================</span>
<span class="w">    </span><span class="c1"># PHASE 1-3 MVP API ENDPOINTS</span>
<span class="w">    </span><span class="c1"># ========================================================================</span>

<span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="s">/api/agents/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7002/</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Request-Id</span><span class="w"> </span><span class="nv">$request_id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="s">/api/city/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7001/</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Request-Id</span><span class="w"> </span><span class="nv">$request_id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="s">/api/secondme/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7003/</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Request-Id</span><span class="w"> </span><span class="nv">$request_id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="s">/api/microdao/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7004/</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Request-Id</span><span class="w"> </span><span class="nv">$request_id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># WebSocket –¥–ª—è City</span>
<span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="s">/ws/city/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:7001/ws/city/</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Upgrade</span><span class="w"> </span><span class="nv">$http_upgrade</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Connection</span><span class="w"> </span><span class="s">&quot;upgrade&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">        </span><span class="kn">proxy_read_timeout</span><span class="w"> </span><span class="mi">86400</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å</span>
sudo<span class="w"> </span>nginx<span class="w"> </span>-t

<span class="c1"># –Ø–∫—â–æ OK ‚Äî reload</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>nginx

<span class="c1"># –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] Backup Nginx config —Å—Ç–≤–æ—Ä–µ–Ω–æ
- [ ] –ù–æ–≤—ñ location blocks –¥–æ–¥–∞–Ω–æ
- [ ] <code>nginx -t</code> —É—Å–ø—ñ—à–Ω–∏–π
- [ ] <code>systemctl reload nginx</code> —É—Å–ø—ñ—à–Ω–∏–π</p>
<hr />
<h3 id="8-smoke-tests-1">–§–∞–∑–∞ 8: SMOKE TESTS (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#8-smoke-tests-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Health checks (–ª–æ–∫–∞–ª—å–Ω–æ)</span>
curl<span class="w"> </span>http://localhost:7001/health<span class="w">  </span><span class="c1"># City</span>
curl<span class="w"> </span>http://localhost:7002/health<span class="w">  </span><span class="c1"># Agents</span>
curl<span class="w"> </span>http://localhost:7003/health<span class="w">  </span><span class="c1"># Second Me</span>
curl<span class="w"> </span>http://localhost:7004/health<span class="w">  </span><span class="c1"># MicroDAO</span>

<span class="c1"># 2. Health checks (—á–µ—Ä–µ–∑ Nginx/SSL)</span>
curl<span class="w"> </span>https://gateway.daarion.city/api/city/health
curl<span class="w"> </span>https://gateway.daarion.city/api/agents/health
curl<span class="w"> </span>https://gateway.daarion.city/api/secondme/health
curl<span class="w"> </span>https://gateway.daarion.city/api/microdao/health

<span class="c1"># 3. City Rooms API</span>
curl<span class="w"> </span>https://gateway.daarion.city/api/city/rooms<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq

<span class="c1"># 4. WebSocket (—á–µ—Ä–µ–∑ wscat –∞–±–æ websocat)</span>
websocat<span class="w"> </span>wss://gateway.daarion.city/ws/city/rooms/general
</code></pre></div>

<p><strong>Expected Results:</strong>
- [ ] –í—Å—ñ health endpoints ‚Üí 200 OK
- [ ] City Rooms API ‚Üí 5 default rooms
- [ ] WebSocket ‚Üí connection established</p>
<hr />
<h3 id="9-monitoring-1">–§–∞–∑–∞ 9: MONITORING (–ù–∞ –ù–û–î–ê1)<a class="headerlink" href="#9-monitoring-1" title="Permanent link">&para;</a></h3>
<p><strong>–ú–µ—Ç–∞:</strong> –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è —â–æ —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ (–ø–µ—Ä—à—ñ 5 —Ö–≤–∏–ª–∏–Ω)</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>logs<span class="w"> </span>--tail<span class="o">=</span><span class="m">100</span><span class="w"> </span>-f<span class="w"> </span>agents-service<span class="w"> </span>city-service

<span class="c1"># 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏</span>
docker<span class="w"> </span>stats<span class="w"> </span>--no-stream

<span class="c1"># 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Prometheus metrics (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π)</span>
curl<span class="w"> </span>http://localhost:9090/api/v1/query?query<span class="o">=</span>up<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq

<span class="c1"># 4. Grafana (—è–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π)</span>
<span class="c1"># –í—ñ–¥–∫—Ä–∏—Ç–∏ http://localhost:3000 —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∏</span>
</code></pre></div>

<p><strong>Checklist:</strong>
- [ ] –ù–µ–º–∞—î error –ª–æ–≥—ñ–≤ (–ø–µ—Ä—à—ñ 5 —Ö–≤–∏–ª–∏–Ω)
- [ ] CPU/RAM –≤ –Ω–æ—Ä–º—ñ
- [ ] Prometheus –±–∞—á–∏—Ç—å –Ω–æ–≤—ñ —Ç–∞—Ä–≥–µ—Ç–∏
- [ ] Grafana –ø–æ–∫–∞–∑—É—î –º–µ—Ç—Ä–∏–∫–∏</p>
<hr />
<h2 id="rollback-plan">üö® Rollback Plan<a class="headerlink" href="#rollback-plan" title="Permanent link">&para;</a></h2>
<h3 id="6-service-startup-failed">–Ø–∫—â–æ –§–∞–∑–∞ 6 (Service Startup) failed:<a class="headerlink" href="#6-service-startup-failed" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. –ó—É–ø–∏–Ω–∏—Ç–∏ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>stop<span class="w"> </span>agents-service<span class="w"> </span>city-service<span class="w"> </span>secondme-service<span class="w"> </span>microdao-service

<span class="c1"># 2. –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏</span>
docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.all.yml<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>agents-service<span class="w"> </span>city-service<span class="w"> </span>secondme-service<span class="w"> </span>microdao-service

<span class="c1"># 3. –í—ñ–¥–∫–∞—Ç–∏—Ç–∏ –ë–î</span>
docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span>daarion-postgres<span class="w"> </span>psql<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>daarion_memory<span class="w"> </span>&lt;<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/root/backups/daarion_memory_YYYYMMDD_HHMMSS.sql

<span class="c1"># 4. –°–∏—Å—Ç–µ–º–∞ –ø–æ–≤–µ—Ä–Ω—É–ª–∞—Å—å –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ —Å—Ç–∞–Ω—É</span>
</code></pre></div>

<h3 id="7-nginx-update-failed">–Ø–∫—â–æ –§–∞–∑–∞ 7 (Nginx Update) failed:<a class="headerlink" href="#7-nginx-update-failed" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ Nginx config</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/etc/nginx/sites-available/daarion.backup.YYYYMMDD_HHMMSS<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>/etc/nginx/sites-available/daarion

<span class="c1"># Reload</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>nginx
</code></pre></div>

<hr />
<h2 id="final-checklist">üìã Final Checklist<a class="headerlink" href="#final-checklist" title="Permanent link">&para;</a></h2>
<h3 id="pre-deployment">Pre-Deployment:<a class="headerlink" href="#pre-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Git push –∑ –ù–û–î–ê2 –≤–∏–∫–æ–Ω–∞–Ω–æ</li>
<li>[ ] Backup –ë–î –Ω–∞ –ù–û–î–ê1 —Å—Ç–≤–æ—Ä–µ–Ω–æ (—ñ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ!)</li>
<li>[ ] .env —Ñ–∞–π–ª –æ–Ω–æ–≤–ª–µ–Ω–æ</li>
<li>[ ] Nginx backup —Å—Ç–≤–æ—Ä–µ–Ω–æ</li>
</ul>
<h3 id="deployment">Deployment:<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Git pull –Ω–∞ –ù–û–î–ê1 —É—Å–ø—ñ—à–Ω–∏–π</li>
<li>[ ] –ú—ñ–≥—Ä–∞—Ü—ñ—ó 007-010 –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ</li>
<li>[ ] –ù–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑—ñ–±—Ä–∞–Ω—ñ</li>
<li>[ ] –ù–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞–ø—É—â–µ–Ω—ñ</li>
<li>[ ] Nginx config –æ–Ω–æ–≤–ª–µ–Ω–æ</li>
<li>[ ] Nginx reload —É—Å–ø—ñ—à–Ω–∏–π</li>
</ul>
<h3 id="post-deployment">Post-Deployment:<a class="headerlink" href="#post-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Health checks: 4/4 ‚úÖ</li>
<li>[ ] City Rooms API –ø—Ä–∞—Ü—é—î</li>
<li>[ ] WebSocket –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—î</li>
<li>[ ] –õ–æ–≥–∏ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫</li>
<li>[ ] –Ü—Å–Ω—É—é—á—ñ DAGI —Å–µ—Ä–≤—ñ—Å–∏ –ø—Ä–∞—Ü—é—é—Ç—å —Å—Ç–∞–±—ñ–ª—å–Ω–æ</li>
<li>[ ] Monitoring –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ</li>
</ul>
<hr />
<h2 id="success-criteria">üéØ Success Criteria<a class="headerlink" href="#success-criteria" title="Permanent link">&para;</a></h2>
<p><strong>MVP –≤–≤–∞–∂–∞—î—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ –∑–∞–¥–µ–ø–ª–æ—î–Ω–∏–º —è–∫—â–æ:</strong></p>
<ol>
<li>‚úÖ –í—Å—ñ 4 –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞–ø—É—â–µ–Ω—ñ —ñ healthy</li>
<li>‚úÖ API endpoints –¥–æ—Å—Ç—É–ø–Ω—ñ —á–µ—Ä–µ–∑ <code>https://gateway.daarion.city/api/*</code></li>
<li>‚úÖ WebSocket –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ <code>wss://gateway.daarion.city/ws/city/*</code></li>
<li>‚úÖ City Rooms API –ø–æ–≤–µ—Ä—Ç–∞—î 5 default rooms</li>
<li>‚úÖ –Ü—Å–Ω—É—é—á—ñ DAGI —Å–µ—Ä–≤—ñ—Å–∏ –ù–ï –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏</li>
<li>‚úÖ Prometheus/Grafana –±–∞—á–∞—Ç—å –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏</li>
<li>‚úÖ –ù–µ–º–∞—î –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ –≤ –ª–æ–≥–∞—Ö (–ø–µ—Ä—à—ñ 30 —Ö–≤–∏–ª–∏–Ω)</li>
</ol>
<hr />
<h2 id="next-steps-deployment">üîÆ Next Steps (–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ deployment)<a class="headerlink" href="#next-steps-deployment" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Frontend Integration</strong> ‚Äî –û–Ω–æ–≤–∏—Ç–∏ Frontend (port 8899) –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –Ω–æ–≤–∏–º–∏ API</li>
<li><strong>Multimodal Integration</strong> ‚Äî –ö–æ–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≥–æ—Ç–æ–≤—ñ, —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ STT/OCR/Web Search</li>
<li><strong>Load Testing</strong> ‚Äî –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –Ω–æ–≤—ñ —Å–µ—Ä–≤—ñ—Å–∏</li>
<li><strong>Documentation Update</strong> ‚Äî –û–Ω–æ–≤–∏—Ç–∏ INFRASTRUCTURE.md –∑ –Ω–æ–≤–∏–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏</li>
<li><strong>Monitoring Dashboards</strong> ‚Äî –°—Ç–≤–æ—Ä–∏—Ç–∏ Grafana –¥–∞—à–±–æ—Ä–¥–∏ –¥–ª—è Phase 1-3</li>
</ol>
<hr />
<h2 id="emergency-contacts">üìû Emergency Contacts<a class="headerlink" href="#emergency-contacts" title="Permanent link">&para;</a></h2>
<p><strong>–Ø–∫—â–æ —â–æ—Å—å –π–¥–µ –Ω–µ —Ç–∞–∫:</strong>
- Backup –ë–î: <code>/root/backups/daarion_memory_*.sql</code>
- Rollback command: <code>docker compose -f docker-compose.all.yml stop ...</code>
- Nginx restore: <code>sudo cp /etc/nginx/sites-available/daarion.backup.* ...</code></p>
<hr />
<p><strong>–î–æ–∫—É–º–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ:</strong> Cursor AI Assistant<br />
<strong>–î–ª—è –ø—Ä–æ—î–∫—Ç—É:</strong> MicroDAO DAARION<br />
<strong>–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:</strong> 2025-11-25</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.instant", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  </body>
</html>